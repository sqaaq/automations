// ==UserScript==
// @name         Edit AD user .PS
// @namespace    https://sqaaq.github.io/automations
// @version      1.11.1
// @description  Кнопка появляется только при наличии "Выход нового сотрудника" в заголовке + FullAutoAnswer + Passw gen + mailbox create
// @author       Egor & AI
// @match        https://*/front/ticket.form.php?*
// @downloadURL  https://sqaaq.github.io/automations/userscripts/editADuser.user.js
// @updateURL    https://sqaaq.github.io/automations/userscripts/editADuser.meta.js
// @grant        none
// ==/UserScript==

function _0x3063(){const _0x52bc31=['classList','\x27\x20|\x20Select-Object\x20DisplayName,PrimarySmtpAddress\x20|\x20Format-List\x0aRemove-PSSession\x20$Session\x0aWrite-Output\x20\x22DON\x27T\x20FORGET\x20TO\x20CHANGE\x20USER\x20OU\x22\x0a','23456789','ADVelop','abcdefghjkmnpqrstuvwxyz','100px','click','58317qZItui','EditADuser.PS','account','\x0aДобрый\x20день!<br>\x0aУчетная\x20запись\x20готова.<br>\x0aПочта:\x20','overflowY','\x27\x0a$Session\x20=\x20New-PSSession\x20-ConfigurationName\x20Microsoft.Exchange\x20-ConnectionUri\x20http://DC1-EXCH-02.advmoscow.ru/PowerShell/\x20-Authentication\x20Kerberos\x0aImport-PSSession\x20$Session\x0aEnable-Mailbox\x20-Identity\x20\x27','1\x201\x20auto','4ybGLJY','whiteSpace','clipboard','200px','innerHTML','startsWith','7nFneMV','replace','+7\x20','maxWidth','inline-block','Arena','background','9eqPqgv','\x27\x20-Replace\x20@{mobile=\x27','ADV\x20Digital','test','1915065AyCqzu','1px\x20solid\x20#ccc','ADV\x20Benchmark','company','trim','iframe[id^=\x22content_\x22]','domain','flex','<br><br>\x0aTeams:\x20','button','10px','Copy','toUpperCase','5990030FSiIoP','border','match','flex-start','14beFekW','3029944BRpVEc','addEventListener','writeText','cursor','Не\x20найдено\x20поле\x20ввода','split','477810turETM','ADV\x20eCommerce','length','div','column','@advmoscow.ru<br>\x0aПароль:\x20','OTC','insertAdjacentElement','Points','manager','querySelector','minWidth','padding','alignItems','\x0a$managers\x20=\x20Get-ADUser\x20-Filter\x20{\x20info\x20-like\x20\x22*','ADV\x20Performance','ABCDEFGHJKLMNPQRSTUVWXYZ','.rich_text_container','birth_date','Copy.PS','139404YynPic','713815pLmRaT','block','center','random','push','#f0f0f0','contentWindow','afterend','contentDocument','\x27\x20-NewPassword\x20(ConvertTo-SecureString\x20\x22','useremail','display','none','\x27;\x20extensionAttribute1=\x27','fio','load','Copied!','AutoAnswer','Initiative','.edit-ps-container','1045YrlkCI','gap','then','floor','createElement','document','justifyContent','body','\x22\x20-AsPlainText\x20-Force)\x20-Reset\x0aEnable-ADAccount\x20-Identity\x20\x27','width','appendChild','textContent','toLowerCase','slice','pre','pointer','auto','style','join','pre-wrap','\x27}\x0a}\x0a\x0aSet-ADAccountPassword\x20-Identity\x20\x27','300px','<br><br>\x0aНоутбук\x20|\x20rds.advmoscow.ru\x20|\x20Удаленный\x20рабочий\x20стол<br>\x0aЛогин:\x20advmoscow\x5c','edit-ps-container','\x27}\x20-Manager\x20$managerDN\x0a}\x20else\x20{\x0a\x20\x20\x20\x20Set-ADUser\x20-Identity\x20\x27','.card-title.card-header.mx-n3.mt-n3','phone','marginTop'];_0x3063=function(){return _0x52bc31;};return _0x3063();}function _0xb90a(_0x565901,_0x50e37f){const _0x306377=_0x3063();return _0xb90a=function(_0xb90a6b,_0x495bfa){_0xb90a6b=_0xb90a6b-0x13a;let _0x4c46b5=_0x306377[_0xb90a6b];return _0x4c46b5;},_0xb90a(_0x565901,_0x50e37f);}(function(_0x506039,_0x9977aa){const _0x33967f=_0xb90a,_0x162be6=_0x506039();while(!![]){try{const _0x41098b=parseInt(_0x33967f(0x181))/0x1*(-parseInt(_0x33967f(0x1aa))/0x2)+parseInt(_0x33967f(0x199))/0x3*(-parseInt(_0x33967f(0x188))/0x4)+parseInt(_0x33967f(0x14a))/0x5+-parseInt(_0x33967f(0x1b1))/0x6*(parseInt(_0x33967f(0x18e))/0x7)+-parseInt(_0x33967f(0x1ab))/0x8*(parseInt(_0x33967f(0x195))/0x9)+parseInt(_0x33967f(0x1a6))/0xa+-parseInt(_0x33967f(0x15e))/0xb*(-parseInt(_0x33967f(0x149))/0xc);if(_0x41098b===_0x9977aa)break;else _0x162be6['push'](_0x162be6['shift']());}catch(_0x2b7026){_0x162be6['push'](_0x162be6['shift']());}}}(_0x3063,0x531cd),(function(){'use strict';const _0x32a8b8=_0xb90a;function _0x459ad5(_0x551d75){const _0x1bb595=_0xb90a;let _0x59e9d1=_0x551d75[_0x1bb595(0x18f)](/\D/g,'');if(_0x59e9d1[_0x1bb595(0x18d)]('8')&&_0x59e9d1[_0x1bb595(0x1b3)]===0xb)_0x59e9d1='7'+_0x59e9d1[_0x1bb595(0x16b)](0x1);else{if(_0x59e9d1[_0x1bb595(0x18d)]('9')&&_0x59e9d1[_0x1bb595(0x1b3)]===0xa)_0x59e9d1='7'+_0x59e9d1;else{if(_0x59e9d1[_0x1bb595(0x18d)]('+7')){_0x59e9d1=_0x59e9d1[_0x1bb595(0x16b)](0x2);if(_0x59e9d1[_0x1bb595(0x1b3)]===0xa)_0x59e9d1='7'+_0x59e9d1;}}}if(_0x59e9d1[_0x1bb595(0x1b3)]===0xb&&_0x59e9d1[_0x1bb595(0x18d)]('7'))return _0x1bb595(0x190)+_0x59e9d1[_0x1bb595(0x16b)](0x1,0x4)+'\x20'+_0x59e9d1[_0x1bb595(0x16b)](0x4,0x7)+'\x20'+_0x59e9d1['slice'](0x7,0x9)+'\x20'+_0x59e9d1['slice'](0x9,0xb);return _0x551d75;}function _0x55ce4(_0x560f07=0x8){const _0x3e82b0=_0xb90a,_0x57f760=_0x3e82b0(0x145),_0x383b28=_0x3e82b0(0x17e),_0x7cbc8e=_0x3e82b0(0x17c),_0x468428=_0x57f760+_0x383b28+_0x7cbc8e;let _0x726906=[_0x57f760[Math[_0x3e82b0(0x161)](Math['random']()*_0x57f760[_0x3e82b0(0x1b3)])],_0x383b28[Math['floor'](Math['random']()*_0x383b28[_0x3e82b0(0x1b3)])],_0x7cbc8e[Math[_0x3e82b0(0x161)](Math[_0x3e82b0(0x14d)]()*_0x7cbc8e[_0x3e82b0(0x1b3)])]];for(let _0x5adbd1=0x3;_0x5adbd1<_0x560f07;_0x5adbd1++){_0x726906[_0x3e82b0(0x14e)](_0x468428[Math['floor'](Math[_0x3e82b0(0x14d)]()*_0x468428['length'])]);}for(let _0x7c850a=_0x726906[_0x3e82b0(0x1b3)]-0x1;_0x7c850a>0x0;_0x7c850a--){const _0x4d0e30=Math['floor'](Math['random']()*(_0x7c850a+0x1));[_0x726906[_0x7c850a],_0x726906[_0x4d0e30]]=[_0x726906[_0x4d0e30],_0x726906[_0x7c850a]];}return _0x726906[_0x3e82b0(0x170)]('');}const _0x2ecede=_0x55ce4();function _0x3e6957(_0x3e9d5d){const _0x1cb124=_0xb90a;let _0x2d2989=_0x3e9d5d[_0x1cb124(0x19d)]()[_0x1cb124(0x1b0)](/\s+/);if(_0x2d2989['length']>=0x2)return _0x2d2989[0x1]+'\x20'+_0x2d2989[0x0];return _0x3e9d5d;}function _0x113d8f(_0x1d27a4){const _0x18dac3=_0xb90a;if(!_0x1d27a4||!_0x1d27a4[_0x18dac3(0x1b3)])return'';return _0x1d27a4[0x0][_0x18dac3(0x1a5)]()+_0x1d27a4[_0x18dac3(0x16b)](0x1)[_0x18dac3(0x16a)]();}function _0x3f315e(_0x4e7b5f,_0x4064f8){const _0x524e0f=_0xb90a;let _0x409d11=_0x4e7b5f[_0x524e0f(0x19d)]()[_0x524e0f(0x1b0)](/\s+/);if(_0x409d11[_0x524e0f(0x1b3)]<0x2)return'';let _0x592547=_0x113d8f(_0x409d11[0x1]),_0x530f55=_0x113d8f(_0x409d11[0x0]);return _0x592547+'.'+_0x530f55+'@'+_0x4064f8;}function _0x25fb68(_0x1ca2f5){const _0x300df9=_0xb90a;let _0x432aff={},_0x2925c3=_0x1ca2f5[_0x300df9(0x1a8)](/учетная запись\s+(\w+)/i),_0x3a11a3=_0x1ca2f5['match'](/Телефон:\s*(\d+)/i),_0x3e6b60=_0x1ca2f5[_0x300df9(0x1a8)](/Дата рождения:\s*([\d\.]+)/i),_0x225454=_0x1ca2f5[_0x300df9(0x1a8)](/Руководитель:\s*([\u0400-\u04FF\s\-]+)/i),_0x3f92cb=_0x1ca2f5[_0x300df9(0x1a8)](/Почтовый домен:\s*([\w\.\-]+)/i),_0x5984c8=_0x1ca2f5['match'](/Фамилия\/имя:\s*([A-Za-zА-Яа-яЁё\s\-]+)/i);if(_0x2925c3)_0x432aff[_0x300df9(0x183)]=_0x2925c3[0x1];if(_0x3a11a3)_0x432aff[_0x300df9(0x178)]=_0x459ad5(_0x3a11a3[0x1]);if(_0x3e6b60)_0x432aff[_0x300df9(0x147)]=_0x3e6b60[0x1];if(_0x225454)_0x432aff['manager']=_0x225454[0x1]['trim']();if(_0x3f92cb){let _0x3adba4=_0x3f92cb[0x1][_0x300df9(0x16a)]();_0x3adba4[_0x300df9(0x18d)]('@')&&(_0x3adba4=_0x3adba4[_0x300df9(0x16b)](0x1));const _0x4421b8={'pointsgroup.ru':_0x300df9(0x13d),'arenamb.ru':_0x300df9(0x193),'advgroup.ru':'ADV','advbenchmark.ru':_0x300df9(0x19b),'advdigital.ru':_0x300df9(0x197),'advperformance.ru':_0x300df9(0x144),'initiativemedia.ru':_0x300df9(0x15c),'otc24.ru':_0x300df9(0x13b),'umww.ru':'UM','advecomm.ru':_0x300df9(0x1b2),'advelop.ru':_0x300df9(0x17d)};_0x432aff[_0x300df9(0x19c)]=_0x4421b8[_0x3adba4]||'',_0x432aff[_0x300df9(0x19f)]=_0x3adba4;}return _0x5984c8&&_0x3f92cb&&(_0x432aff['fio']=_0x5984c8[0x1][_0x300df9(0x19d)](),_0x432aff[_0x300df9(0x154)]=_0x3f315e(_0x432aff[_0x300df9(0x158)],_0x432aff[_0x300df9(0x19f)])),_0x432aff;}function _0x245d70(_0x1f1022){const _0x16be5d=_0xb90a;if(!_0x1f1022[_0x16be5d(0x183)]||!_0x1f1022[_0x16be5d(0x178)]||!_0x1f1022[_0x16be5d(0x147)]||!_0x1f1022[_0x16be5d(0x13e)])return'Ошибка:\x20Не\x20найдены\x20необходимые\x20поля\x20в\x20заявке.';let _0x37ffbf=_0x3e6957(_0x1f1022[_0x16be5d(0x13e)]);return(_0x16be5d(0x143)+_0x37ffbf+'*\x22\x20}\x20-Properties\x20SamAccountName,\x20DistinguishedName\x0a$primaryManager\x20=\x20$managers\x20|\x20Where-Object\x20{\x20$_.SamAccountName\x20-notmatch\x20\x22^[A-Z]{3}\x5c.\x22\x20}\x20|\x20Select-Object\x20-First\x201\x0a\x0aif\x20($primaryManager\x20-ne\x20$null)\x20{\x0a\x20\x20\x20\x20$managerDN\x20=\x20$primaryManager.DistinguishedName\x0a\x20\x20\x20\x20Set-ADUser\x20-Identity\x20\x27'+_0x1f1022[_0x16be5d(0x183)]+_0x16be5d(0x196)+_0x1f1022[_0x16be5d(0x178)]+_0x16be5d(0x157)+_0x1f1022[_0x16be5d(0x147)]+'\x27;\x20company=\x27'+_0x1f1022['company']+_0x16be5d(0x176)+_0x1f1022[_0x16be5d(0x183)]+_0x16be5d(0x196)+_0x1f1022[_0x16be5d(0x178)]+'\x27;\x20extensionAttribute1=\x27'+_0x1f1022[_0x16be5d(0x147)]+'\x27;\x20company=\x27'+_0x1f1022[_0x16be5d(0x19c)]+_0x16be5d(0x172)+_0x1f1022[_0x16be5d(0x183)]+_0x16be5d(0x153)+_0x2ecede+_0x16be5d(0x166)+_0x1f1022[_0x16be5d(0x183)]+'\x27\x0aAdd-ADGroupMember\x20-Identity\x20\x22SG-G-AnyconnectUsers\x22\x20-Members\x20\x27'+_0x1f1022['account']+_0x16be5d(0x186)+_0x1f1022[_0x16be5d(0x183)]+'\x27\x0aGet-Mailbox\x20-Identity\x20\x27'+_0x1f1022[_0x16be5d(0x183)]+_0x16be5d(0x17b))[_0x16be5d(0x19d)]();}function _0x3d152b(){return new Promise(_0x30ce50=>{const _0x2fa4a8=()=>{const _0x2990bd=_0xb90a,_0x41f947=document[_0x2990bd(0x13f)](_0x2990bd(0x19e));if(_0x41f947)_0x30ce50(_0x41f947);else setTimeout(_0x2fa4a8,0x1f4);};_0x2fa4a8();});}function _0x4802b4(){const _0x30eae2=_0xb90a,_0x2a9465=document[_0x30eae2(0x13f)]('.mt-2.timeline-content.left.card');if(!_0x2a9465)return;const _0x5d0df1=_0x2a9465['querySelector'](_0x30eae2(0x177));if(!_0x5d0df1||!/выход нового сотрудника/i[_0x30eae2(0x198)](_0x5d0df1[_0x30eae2(0x169)]))return;const _0x34e8d9=_0x2a9465[_0x30eae2(0x13f)](_0x30eae2(0x146));if(!_0x34e8d9||_0x2a9465[_0x30eae2(0x13f)](_0x30eae2(0x15d)))return;const _0x492654=_0x2a9465['innerText'],_0x3ecb03=_0x25fb68(_0x492654),_0x55891e=document['createElement']('div');_0x55891e[_0x30eae2(0x17a)]['add'](_0x30eae2(0x175)),_0x55891e[_0x30eae2(0x16f)][_0x30eae2(0x155)]='flex',_0x55891e[_0x30eae2(0x16f)][_0x30eae2(0x142)]=_0x30eae2(0x1a9),_0x55891e[_0x30eae2(0x16f)][_0x30eae2(0x15f)]='25px',_0x55891e[_0x30eae2(0x16f)][_0x30eae2(0x179)]=_0x30eae2(0x1a3);const _0x694c8e=document[_0x30eae2(0x162)](_0x30eae2(0x1b4));_0x694c8e[_0x30eae2(0x16f)]['display']=_0x30eae2(0x1a0),_0x694c8e['style']['flexDirection']=_0x30eae2(0x1b5),_0x694c8e[_0x30eae2(0x16f)][_0x30eae2(0x164)]=_0x30eae2(0x1a9),_0x694c8e[_0x30eae2(0x16f)][_0x30eae2(0x142)]=_0x30eae2(0x14c);const _0x4b657d=document[_0x30eae2(0x162)](_0x30eae2(0x1a2));_0x4b657d[_0x30eae2(0x169)]=_0x30eae2(0x182),_0x4b657d[_0x30eae2(0x16f)][_0x30eae2(0x1ae)]=_0x30eae2(0x16d),_0x4b657d['style'][_0x30eae2(0x167)]='120px',_0x694c8e[_0x30eae2(0x168)](_0x4b657d);const _0x102b92=document['createElement'](_0x30eae2(0x1b4));_0x102b92[_0x30eae2(0x16f)]['flex']=_0x30eae2(0x187);const _0x5228d2=document[_0x30eae2(0x162)](_0x30eae2(0x16c));_0x5228d2[_0x30eae2(0x16f)][_0x30eae2(0x194)]=_0x30eae2(0x14f),_0x5228d2[_0x30eae2(0x16f)][_0x30eae2(0x1a7)]=_0x30eae2(0x19a),_0x5228d2[_0x30eae2(0x16f)][_0x30eae2(0x141)]=_0x30eae2(0x1a3),_0x5228d2[_0x30eae2(0x16f)][_0x30eae2(0x189)]=_0x30eae2(0x171),_0x5228d2[_0x30eae2(0x16f)]['margin']='0',_0x5228d2[_0x30eae2(0x16f)][_0x30eae2(0x140)]=_0x30eae2(0x173),_0x5228d2[_0x30eae2(0x16f)][_0x30eae2(0x191)]='600px',_0x5228d2['style'][_0x30eae2(0x155)]=_0x30eae2(0x156),_0x5228d2[_0x30eae2(0x16f)]['maxHeight']=_0x30eae2(0x18b),_0x5228d2[_0x30eae2(0x16f)][_0x30eae2(0x185)]=_0x30eae2(0x16e),_0x102b92[_0x30eae2(0x168)](_0x5228d2);const _0x418053=document[_0x30eae2(0x162)]('div');_0x418053[_0x30eae2(0x16f)][_0x30eae2(0x155)]=_0x30eae2(0x1a0),_0x418053[_0x30eae2(0x16f)]['flexDirection']='column',_0x418053['style'][_0x30eae2(0x164)]=_0x30eae2(0x1a9),_0x418053[_0x30eae2(0x16f)]['alignItems']='center',_0x418053[_0x30eae2(0x16f)][_0x30eae2(0x15f)]='10px';const _0x24113a=document['createElement']('button');_0x24113a[_0x30eae2(0x169)]=_0x30eae2(0x15b),_0x24113a[_0x30eae2(0x16f)][_0x30eae2(0x1ae)]=_0x30eae2(0x16d),_0x24113a[_0x30eae2(0x16f)][_0x30eae2(0x167)]=_0x30eae2(0x17f),_0x418053['appendChild'](_0x24113a);const _0xf81bc5=document[_0x30eae2(0x162)]('button');_0xf81bc5[_0x30eae2(0x169)]=_0x30eae2(0x148),_0xf81bc5[_0x30eae2(0x16f)][_0x30eae2(0x1ae)]=_0x30eae2(0x16d),_0xf81bc5[_0x30eae2(0x16f)][_0x30eae2(0x155)]=_0x30eae2(0x156),_0xf81bc5[_0x30eae2(0x16f)]['width']='100px',_0x418053[_0x30eae2(0x168)](_0xf81bc5),_0x4b657d['addEventListener'](_0x30eae2(0x180),()=>{const _0xd274aa=_0x30eae2;if(_0x5228d2[_0xd274aa(0x16f)][_0xd274aa(0x155)]===_0xd274aa(0x14b))_0x5228d2['style'][_0xd274aa(0x155)]=_0xd274aa(0x156),_0xf81bc5['style'][_0xd274aa(0x155)]=_0xd274aa(0x156);else{const _0x84056a=_0x245d70(_0x3ecb03);_0x5228d2[_0xd274aa(0x169)]=_0x84056a,_0x5228d2[_0xd274aa(0x16f)]['display']=_0xd274aa(0x14b),_0xf81bc5[_0xd274aa(0x16f)][_0xd274aa(0x155)]=_0xd274aa(0x192);}}),_0xf81bc5[_0x30eae2(0x1ac)](_0x30eae2(0x180),()=>{const _0x53588d=_0x30eae2;_0x5228d2[_0x53588d(0x169)]['trim']()&&navigator[_0x53588d(0x18a)][_0x53588d(0x1ad)](_0x5228d2[_0x53588d(0x169)])[_0x53588d(0x160)](()=>{const _0x47b614=_0x53588d;_0xf81bc5[_0x47b614(0x169)]=_0x47b614(0x15a),setTimeout(()=>{const _0x4908e3=_0x47b614;_0xf81bc5[_0x4908e3(0x169)]=_0x4908e3(0x1a4);},0x7d0);});}),_0x24113a['addEventListener'](_0x30eae2(0x180),async()=>{const _0x3e6276=_0x30eae2,_0xedc0bd=document[_0x3e6276(0x13f)]('button.answer-action');if(_0xedc0bd)_0xedc0bd['click']();else{alert('Кнопка\x20\x22Ответ\x22\x20не\x20найдена');return;}const _0x41bae8=await _0x3d152b();if(_0x41bae8){const _0x5bf423=_0x41bae8[_0x3e6276(0x152)]||_0x41bae8[_0x3e6276(0x150)][_0x3e6276(0x163)];_0x5bf423[_0x3e6276(0x165)][_0x3e6276(0x18c)]=_0x3e6276(0x184)+_0x3ecb03[_0x3e6276(0x154)]+_0x3e6276(0x1a1)+_0x3ecb03[_0x3e6276(0x183)]+_0x3e6276(0x13a)+_0x2ecede+_0x3e6276(0x174)+_0x3ecb03[_0x3e6276(0x183)]+'<br>\x0aПароль:\x20'+_0x2ecede;}else alert(_0x3e6276(0x1af));}),_0x55891e[_0x30eae2(0x168)](_0x694c8e),_0x55891e[_0x30eae2(0x168)](_0x102b92),_0x55891e[_0x30eae2(0x168)](_0x418053),_0x34e8d9[_0x30eae2(0x13c)](_0x30eae2(0x151),_0x55891e);}window[_0x32a8b8(0x1ac)](_0x32a8b8(0x159),()=>{setTimeout(_0x4802b4,0x3e8);});}()));
