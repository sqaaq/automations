// ==UserScript==
// @name         Edit AD user .PS
// @namespace    https://sqaaq.github.io/automations
// @version      1.9.3
// @description  Кнопка появляется только при наличии "Выход нового сотрудника" в заголовке
// @author       Egor & AI
// @match        https://*/front/ticket.form.php?*
// @downloadURL  https://sqaaq.github.com/automations/userscripts/editADuser.user.js
// @updateURL    https://sqaaq.github.com/automations/userscripts/editADuser.meta.js
// @grant        none
// ==/UserScript==

function _0x179c(_0x8858f0,_0xebc2dc){const _0x140242=_0x1402();return _0x179c=function(_0x179c3b,_0x29f692){_0x179c3b=_0x179c3b-0x1e1;let _0x19c94e=_0x140242[_0x179c3b];return _0x19c94e;},_0x179c(_0x8858f0,_0xebc2dc);}function _0x1402(){const _0x44e2e3=['600px','300px','56ZBnoSj','textContent','inline-block','ADV','createElement','\x27;\x20company=\x27','style','slice','ADV\x20Digital','\x27}\x0a\x20\x20\x20\x20\x20\x20\x20\x20Write-Host\x20\x22Attributes\x20edited\x20(!CHECK\x20MANAGER!).\x22\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20Set-ADAccountPassword\x20-Identity\x20\x27','ADV\x20Benchmark','1gouEVp','pointer','account','insertAdjacentElement','10rFPfxi','alignItems','222147vZEESa','innerText','toLowerCase','phone','querySelector','Не\x20удалось\x20скопировать\x20в\x20буфер\x20обмена','inline-flex','7898gCHAJy','\x27}\x20-Manager\x20$managerDN$\x0a\x20\x20\x20\x20\x20\x20\x20\x20Write-Host\x20\x22Attributes\x20and\x20manager\x20edited.\x22\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20Set-ADUser\x20-Identity\x20\x27','replace','manager','then','.mt-2.timeline-content.left.card','\x27;\x20extensionAttribute1=\x27','startsWith','addEventListener','button','1355826mINnxj','display','.edit-ps-container','birth_date','5060ckzxBN','height','flexShrink','ADVelop','\x27\x0a\x20\x20\x20\x20Write-Host\x20\x22Account\x20enabled.\x22\x0a\x0a\x20\x20\x20\x20Add-ADGroupMember\x20-Identity\x20\x22SG-G-AnyconnectUsers\x22\x20-Members\x20\x27','margin','whiteSpace','maxHeight','company','Arena','classList','9719256nXnpXX','\x27\x0a\x20\x20\x20\x20Write-Host\x20\x22User\x20added\x20to\x20SG-G-AnyconnectUsers.\x22\x0a}\x0acatch\x20{\x0a\x20\x20\x20\x20Write-Error\x20$_\x0a\x20\x20\x20\x20Read-Host\x20-Prompt\x20\x22Error.\x20Press\x20Enter\x20to\x20exit\x22\x0a\x20\x20\x20\x20exit\x201\x0a}\x0a','load','div','auto','trim','block','200px','OTC','border','none','3hklwIG','10px','match','Copy','edit-ps-container','catch','overflowY','split','click','13NAPZBK','1px\x20solid\x20#ccc','cursor','Initiative','+7\x20','appendChild','2215624HizeKX','afterend','804923oIkgNk','add','ADV\x20eCommerce','writeText','test','length','minWidth','663218Vzrdse','gap','marginTop','center'];_0x1402=function(){return _0x44e2e3;};return _0x1402();}(function(_0x1ef0bc,_0x5d4274){const _0x2f58d0=_0x179c,_0x1d0628=_0x1ef0bc();while(!![]){try{const _0x1ac885=-parseInt(_0x2f58d0(0x1f0))/0x1*(parseInt(_0x2f58d0(0x239))/0x2)+parseInt(_0x2f58d0(0x221))/0x3*(parseInt(_0x2f58d0(0x230))/0x4)+-parseInt(_0x2f58d0(0x1f4))/0x5*(-parseInt(_0x2f58d0(0x207))/0x6)+-parseInt(_0x2f58d0(0x232))/0x7+parseInt(_0x2f58d0(0x1e5))/0x8*(parseInt(_0x2f58d0(0x1f6))/0x9)+-parseInt(_0x2f58d0(0x20b))/0xa*(-parseInt(_0x2f58d0(0x1fd))/0xb)+-parseInt(_0x2f58d0(0x216))/0xc*(parseInt(_0x2f58d0(0x22a))/0xd);if(_0x1ac885===_0x5d4274)break;else _0x1d0628['push'](_0x1d0628['shift']());}catch(_0x448057){_0x1d0628['push'](_0x1d0628['shift']());}}}(_0x1402,0x45ad9),(function(){'use strict';const _0x443fe8=_0x179c;function _0x57f168(_0x1a3627){const _0x377eef=_0x179c;let _0xa53d22=_0x1a3627[_0x377eef(0x1ff)](/\D/g,'');if(_0xa53d22[_0x377eef(0x204)]('8')&&_0xa53d22['length']===0xb)_0xa53d22='7'+_0xa53d22[_0x377eef(0x1ec)](0x1);else{if(_0xa53d22[_0x377eef(0x204)]('9')&&_0xa53d22[_0x377eef(0x237)]===0xa)_0xa53d22='7'+_0xa53d22;else{if(_0xa53d22[_0x377eef(0x204)]('7')&&_0xa53d22[_0x377eef(0x237)]===0xb){}else{if(_0xa53d22[_0x377eef(0x204)]('+7'))_0xa53d22=_0xa53d22[_0x377eef(0x1ec)](0x2),_0xa53d22[_0x377eef(0x237)]===0xa&&(_0xa53d22='7'+_0xa53d22);else return _0x1a3627;}}}return _0xa53d22[_0x377eef(0x237)]===0xb&&_0xa53d22[_0x377eef(0x204)]('7')?_0x377eef(0x22e)+_0xa53d22[_0x377eef(0x1ec)](0x1,0x4)+'\x20'+_0xa53d22['slice'](0x4,0x7)+'\x20'+_0xa53d22['slice'](0x7,0x9)+'\x20'+_0xa53d22[_0x377eef(0x1ec)](0x9,0xb):_0x1a3627;}function _0x3abd19(_0x307ac3){const _0x574400=_0x179c;let _0x61504f=_0x307ac3['trim']()[_0x574400(0x228)](/\s+/);if(_0x61504f['length']>=0x2){let _0xb411ec=_0x61504f[0x0],_0x1d434f=_0x61504f[0x1];return _0x1d434f+'\x20'+_0xb411ec;}return _0x307ac3;}function _0x555f41(_0x2df598){const _0x12afc8=_0x179c;let _0x2bc8e8={},_0x5588bf=_0x2df598[_0x12afc8(0x223)](/учетная запись\s+(\w+)/i),_0xa5df12=_0x2df598[_0x12afc8(0x223)](/Телефон:\s*(\d+)/i),_0x205e93=_0x2df598[_0x12afc8(0x223)](/Дата рождения:\s*([\d\.]+)/i),_0x440964=_0x2df598[_0x12afc8(0x223)](/Руководитель:\s*([\u0400-\u04FF\s\-]+)/i),_0x410a78=_0x2df598[_0x12afc8(0x223)](/Почтовый домен:\s*([\w\.\-]+)/i);if(_0x5588bf)_0x2bc8e8[_0x12afc8(0x1f2)]=_0x5588bf[0x1];if(_0xa5df12)_0x2bc8e8[_0x12afc8(0x1f9)]=_0x57f168(_0xa5df12[0x1]);if(_0x205e93)_0x2bc8e8[_0x12afc8(0x20a)]=_0x205e93[0x1];if(_0x440964)_0x2bc8e8[_0x12afc8(0x200)]=_0x440964[0x1][_0x12afc8(0x21b)]();if(_0x410a78){const _0x5d7575=_0x410a78[0x1][_0x12afc8(0x1f8)](),_0xf9292e={'pointsgroup.ru':'Points','arenamb.ru':_0x12afc8(0x214),'advgroup.ru':_0x12afc8(0x1e8),'advbenchmark.ru':_0x12afc8(0x1ef),'advdigital.ru':_0x12afc8(0x1ed),'advperformance.ru':'ADV\x20Performance','initiativemedia.ru':_0x12afc8(0x22d),'otc24.ru':_0x12afc8(0x21e),'umww.ru':'UM','advecomm.ru':_0x12afc8(0x234),'advelop.ru':_0x12afc8(0x20e)};_0x2bc8e8[_0x12afc8(0x213)]=_0xf9292e[_0x5d7575]||'';}return _0x2bc8e8;}function _0xdac279(_0x57402c){const _0x58b4c6=_0x179c;if(!_0x57402c['account']||!_0x57402c[_0x58b4c6(0x1f9)]||!_0x57402c['birth_date']||!_0x57402c['manager'])return'Ошибка:\x20Не\x20найдены\x20необходимые\x20поля\x20в\x20заявке.';let _0x41009c=_0x3abd19(_0x57402c[_0x58b4c6(0x200)]),_0x46a690='\x0a\x0a$manager\x20=\x20Get-ADUser\x20-Filter\x20{\x20info\x20-like\x20\x22*'+_0x41009c+'*\x22\x20}\x20-Properties\x20DistinguishedName\x0aif\x20($manager\x20-ne\x20$null\x20-and\x20($manager.Count\x20-eq\x201\x20-or\x20$manager\x20-isnot\x20[System.Array]))\x20{\x0a\x20\x20\x20\x20$managerDN\x20=\x20$manager.DistinguishedName\x0a\x20\x20\x20\x20Write-Host\x20\x22Found\x20manager:\x20$managerDN\x22\x0a\x20\x20\x20\x20$assignManager\x20=\x20$true\x0a}\x20else\x20{\x0a\x20\x20\x20\x20Write-Warning\x20\x22Couldnt\x20find\x20manager.\x20Skipping.\x20CHECK\x20USER\x20MANAGER.\x22\x0a\x20\x20\x20\x20$assignManager\x20=\x20$false\x0a}\x0a\x0atry\x20{\x0a\x20\x20\x20\x20if\x20($assignManager)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20Set-ADUser\x20-Identity\x20\x27'+_0x57402c[_0x58b4c6(0x1f2)]+'\x27\x20-Replace\x20@{mobile=\x27'+_0x57402c[_0x58b4c6(0x1f9)]+_0x58b4c6(0x203)+_0x57402c[_0x58b4c6(0x20a)]+_0x58b4c6(0x1ea)+_0x57402c[_0x58b4c6(0x213)]+_0x58b4c6(0x1fe)+_0x57402c[_0x58b4c6(0x1f2)]+'\x27\x20-Replace\x20@{mobile=\x27'+_0x57402c[_0x58b4c6(0x1f9)]+_0x58b4c6(0x203)+_0x57402c[_0x58b4c6(0x20a)]+_0x58b4c6(0x1ea)+_0x57402c['company']+_0x58b4c6(0x1ee)+_0x57402c[_0x58b4c6(0x1f2)]+'\x27\x20-NewPassword\x20(ConvertTo-SecureString\x20\x22123qwe!@#\x22\x20-AsPlainText\x20-Force)\x20-Reset\x0a\x20\x20\x20\x20Write-Host\x20\x22User\x20password\x20successfully\x20set.\x22\x0a\x0a\x20\x20\x20\x20Enable-ADAccount\x20-Identity\x20\x27'+_0x57402c[_0x58b4c6(0x1f2)]+_0x58b4c6(0x20f)+_0x57402c[_0x58b4c6(0x1f2)]+_0x58b4c6(0x217);return _0x46a690['trim']();}function _0x46b4ca(){const _0x5b0e88=_0x179c,_0x2117e2=document['querySelector'](_0x5b0e88(0x202));if(!_0x2117e2)return;const _0x388539=_0x2117e2[_0x5b0e88(0x1fa)]('.card-title.card-header.mx-n3.mt-n3');if(!_0x388539||!/выход нового сотрудника/i[_0x5b0e88(0x236)](_0x388539[_0x5b0e88(0x1e6)]))return;const _0x213a61=_0x2117e2['querySelector']('.rich_text_container');if(!_0x213a61)return;if(_0x2117e2[_0x5b0e88(0x1fa)](_0x5b0e88(0x209)))return;const _0x3dae90=document[_0x5b0e88(0x1e9)](_0x5b0e88(0x219));_0x3dae90[_0x5b0e88(0x215)][_0x5b0e88(0x233)](_0x5b0e88(0x225)),_0x3dae90[_0x5b0e88(0x1eb)]['display']=_0x5b0e88(0x1fc),_0x3dae90[_0x5b0e88(0x1eb)][_0x5b0e88(0x1f5)]=_0x5b0e88(0x1e2),_0x3dae90[_0x5b0e88(0x1eb)][_0x5b0e88(0x23a)]=_0x5b0e88(0x222),_0x3dae90['style'][_0x5b0e88(0x1e1)]=_0x5b0e88(0x222);const _0x245a9f=document[_0x5b0e88(0x1e9)](_0x5b0e88(0x206));_0x245a9f['textContent']='EditADuser.PS',_0x245a9f[_0x5b0e88(0x1eb)][_0x5b0e88(0x22c)]='pointer';const _0x4e896c=document[_0x5b0e88(0x1e9)]('pre');_0x4e896c[_0x5b0e88(0x1eb)]['background']='#f0f0f0',_0x4e896c[_0x5b0e88(0x1eb)][_0x5b0e88(0x21f)]=_0x5b0e88(0x22b),_0x4e896c['style']['padding']=_0x5b0e88(0x222),_0x4e896c[_0x5b0e88(0x1eb)][_0x5b0e88(0x211)]='pre-wrap',_0x4e896c['style'][_0x5b0e88(0x210)]='0',_0x4e896c['style'][_0x5b0e88(0x238)]=_0x5b0e88(0x1e4),_0x4e896c[_0x5b0e88(0x1eb)]['maxWidth']=_0x5b0e88(0x1e3),_0x4e896c['style'][_0x5b0e88(0x20c)]=_0x5b0e88(0x21a),_0x4e896c[_0x5b0e88(0x1eb)][_0x5b0e88(0x208)]=_0x5b0e88(0x220),_0x4e896c[_0x5b0e88(0x1eb)][_0x5b0e88(0x212)]=_0x5b0e88(0x21d),_0x4e896c[_0x5b0e88(0x1eb)][_0x5b0e88(0x227)]='auto';const _0x16e8b7=document[_0x5b0e88(0x1e9)](_0x5b0e88(0x206));_0x16e8b7['textContent']=_0x5b0e88(0x224),_0x16e8b7[_0x5b0e88(0x1eb)][_0x5b0e88(0x22c)]=_0x5b0e88(0x1f1),_0x16e8b7[_0x5b0e88(0x1eb)][_0x5b0e88(0x20d)]='0',_0x16e8b7[_0x5b0e88(0x1eb)][_0x5b0e88(0x208)]=_0x5b0e88(0x220),_0x16e8b7['addEventListener'](_0x5b0e88(0x229),()=>{const _0x4b0cea=_0x5b0e88;_0x4e896c[_0x4b0cea(0x1e6)]['trim']()&&navigator['clipboard'][_0x4b0cea(0x235)](_0x4e896c[_0x4b0cea(0x1e6)])[_0x4b0cea(0x201)](()=>{const _0x1ea848=_0x4b0cea;_0x16e8b7[_0x1ea848(0x1e6)]='Copied!',setTimeout(()=>{const _0x27e292=_0x1ea848;_0x16e8b7[_0x27e292(0x1e6)]='Copy';},0x7d0);})[_0x4b0cea(0x226)](()=>{const _0x52a032=_0x4b0cea;alert(_0x52a032(0x1fb));});}),_0x3dae90[_0x5b0e88(0x22f)](_0x245a9f),_0x3dae90[_0x5b0e88(0x22f)](_0x4e896c),_0x3dae90[_0x5b0e88(0x22f)](_0x16e8b7),_0x213a61[_0x5b0e88(0x1f3)](_0x5b0e88(0x231),_0x3dae90),_0x245a9f[_0x5b0e88(0x205)](_0x5b0e88(0x229),()=>{const _0x30c029=_0x5b0e88;if(_0x4e896c[_0x30c029(0x1eb)][_0x30c029(0x208)]===_0x30c029(0x21c))_0x4e896c[_0x30c029(0x1eb)][_0x30c029(0x208)]=_0x30c029(0x220),_0x16e8b7['style'][_0x30c029(0x208)]=_0x30c029(0x220);else{const _0x5d6c3b=_0x2117e2[_0x30c029(0x1f7)],_0x1d2c30=_0x555f41(_0x5d6c3b),_0x1fe8bd=_0xdac279(_0x1d2c30);_0x4e896c[_0x30c029(0x1e6)]=_0x1fe8bd,_0x4e896c[_0x30c029(0x1eb)]['display']=_0x30c029(0x21c),_0x16e8b7[_0x30c029(0x1eb)][_0x30c029(0x208)]=_0x30c029(0x1e7);}});}window['addEventListener'](_0x443fe8(0x218),()=>{setTimeout(_0x46b4ca,0x3e8);});}()));
