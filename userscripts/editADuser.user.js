// ==UserScript==
// @name         Edit AD user .PS
// @namespace    https://sqaaq.github.io/automations
// @version      1.9.4
// @description  Кнопка появляется только при наличии "Выход нового сотрудника" в заголовке
// @author       Egor & AI
// @match        https://*/front/ticket.form.php?*
// @downloadURL  https://sqaaq.github.com/automations/userscripts/editADuser.user.js
// @updateURL    https://sqaaq.github.com/automations/userscripts/editADuser.meta.js
// @grant        none
// ==/UserScript==

function _0x3cf8(){const _0x2706b3=['length','1482200rgIaHz','padding','clipboard','appendChild','writeText','company','edit-ps-container','+7\x20','ADV\x20Benchmark','cursor','flexShrink','1209831VuUDdU','24BvAchU','whiteSpace','birth_date','slice','557672tAVbLX','innerText','300px','#f0f0f0','Arena','replace','OTC','auto','10px','display','ADV\x20Performance','querySelector','height','Copied!','279411SDVoWR','\x27}\x20-Manager\x20$managerDN\x0a\x20\x20\x20\x20\x20\x20\x20\x20Write-Host\x20\x22Attributes\x20and\x20manager\x20edited.\x22\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20Set-ADUser\x20-Identity\x20\x27','maxHeight','622hOnFRd','catch','ADV\x20eCommerce','2265668zInBlV','\x0a$managers\x20=\x20Get-ADUser\x20-Filter\x20{\x20info\x20-like\x20\x22*','\x27;\x20company=\x27','trim','ADVelop','\x27;\x20extensionAttribute1=\x27','819804EcLSLx','overflowY','match','phone','block','200px','toLowerCase','createElement','test','1px\x20solid\x20#ccc','inline-flex','1601tKsKbk','startsWith','100oCbrHo','.card-title.card-header.mx-n3.mt-n3','\x27\x0a\x20\x20\x20\x20Write-Host\x20\x22Account\x20enabled.\x22\x0a\x0a\x20\x20\x20\x20Add-ADGroupMember\x20-Identity\x20\x22SG-G-AnyconnectUsers\x22\x20-Members\x20\x27','Copy','EditADuser.PS','margin','Initiative','.mt-2.timeline-content.left.card','inline-block','gap','Не\x20удалось\x20скопировать\x20в\x20буфер\x20обмена','pre','border','pointer','addEventListener','*\x22\x20}\x20-Properties\x20SamAccountName,\x20DistinguishedName\x0a$primaryManager\x20=\x20$managers\x20|\x20Where-Object\x20{\x20$_.SamAccountName\x20-notmatch\x20\x22^[A-Z]{3}\x5c.\x22\x20}\x20|\x20Select-Object\x20-First\x201\x0a\x0aif\x20($primaryManager\x20-ne\x20$null)\x20{\x0a\x20\x20\x20\x20$managerDN\x20=\x20$primaryManager.DistinguishedName\x0a\x20\x20\x20\x20Write-Host\x20\x22Found\x20primary\x20manager:\x20$managerDN\x22\x0a\x20\x20\x20\x20$assignManager\x20=\x20$true\x0a}\x20else\x20{\x0a\x20\x20\x20\x20Write-Warning\x20\x22Couldn\x27t\x20find\x20primary\x20manager.\x20Skipping.\x20CHECK\x20USER\x20MANAGER.\x22\x0a\x20\x20\x20\x20$assignManager\x20=\x20$false\x0a}\x0a\x0atry\x20{\x0a\x20\x20\x20\x20if\x20($assignManager)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20Set-ADUser\x20-Identity\x20\x27','button','Points','add','manager','style','then','none','div','account','27UgJcdN','\x27\x20-Replace\x20@{mobile=\x27','click','textContent'];_0x3cf8=function(){return _0x2706b3;};return _0x3cf8();}function _0x3767(_0x18aa8c,_0x21f79a){const _0x3cf8b2=_0x3cf8();return _0x3767=function(_0x376777,_0x302bb0){_0x376777=_0x376777-0x1ea;let _0x61bce4=_0x3cf8b2[_0x376777];return _0x61bce4;},_0x3767(_0x18aa8c,_0x21f79a);}(function(_0x877225,_0x55568e){const _0x98f3aa=_0x3767,_0x440761=_0x877225();while(!![]){try{const _0x39ee8f=-parseInt(_0x98f3aa(0x1ee))/0x1*(-parseInt(_0x98f3aa(0x22f))/0x2)+-parseInt(_0x98f3aa(0x238))/0x3+parseInt(_0x98f3aa(0x232))/0x4+parseInt(_0x98f3aa(0x20e))/0x5+parseInt(_0x98f3aa(0x21a))/0x6*(-parseInt(_0x98f3aa(0x219))/0x7)+-parseInt(_0x98f3aa(0x21e))/0x8*(parseInt(_0x98f3aa(0x209))/0x9)+parseInt(_0x98f3aa(0x1f0))/0xa*(parseInt(_0x98f3aa(0x22c))/0xb);if(_0x39ee8f===_0x55568e)break;else _0x440761['push'](_0x440761['shift']());}catch(_0xb89747){_0x440761['push'](_0x440761['shift']());}}}(_0x3cf8,0x6badb),(function(){'use strict';function _0x5593d3(_0xdb1472){const _0x28c31d=_0x3767;let _0x5d30cf=_0xdb1472[_0x28c31d(0x223)](/\D/g,'');if(_0x5d30cf['startsWith']('8')&&_0x5d30cf[_0x28c31d(0x20d)]===0xb)_0x5d30cf='7'+_0x5d30cf[_0x28c31d(0x21d)](0x1);else{if(_0x5d30cf[_0x28c31d(0x1ef)]('9')&&_0x5d30cf[_0x28c31d(0x20d)]===0xa)_0x5d30cf='7'+_0x5d30cf;else{if(_0x5d30cf[_0x28c31d(0x1ef)]('7')&&_0x5d30cf[_0x28c31d(0x20d)]===0xb){}else{if(_0x5d30cf[_0x28c31d(0x1ef)]('+7'))_0x5d30cf=_0x5d30cf[_0x28c31d(0x21d)](0x2),_0x5d30cf[_0x28c31d(0x20d)]===0xa&&(_0x5d30cf='7'+_0x5d30cf);else return _0xdb1472;}}}return _0x5d30cf[_0x28c31d(0x20d)]===0xb&&_0x5d30cf[_0x28c31d(0x1ef)]('7')?_0x28c31d(0x215)+_0x5d30cf['slice'](0x1,0x4)+'\x20'+_0x5d30cf[_0x28c31d(0x21d)](0x4,0x7)+'\x20'+_0x5d30cf[_0x28c31d(0x21d)](0x7,0x9)+'\x20'+_0x5d30cf[_0x28c31d(0x21d)](0x9,0xb):_0xdb1472;}function _0x3b304b(_0x395d4d){const _0x346cf2=_0x3767;let _0x4b62cd=_0x395d4d['trim']()['split'](/\s+/);if(_0x4b62cd[_0x346cf2(0x20d)]>=0x2){let _0x442bb4=_0x4b62cd[0x0],_0x42b1cd=_0x4b62cd[0x1];return _0x42b1cd+'\x20'+_0x442bb4;}return _0x395d4d;}function _0x3471a5(_0x3314db){const _0x454eaa=_0x3767;let _0x5da177={},_0x570934=_0x3314db[_0x454eaa(0x23a)](/учетная запись\s+(\w+)/i),_0x5d59c2=_0x3314db[_0x454eaa(0x23a)](/Телефон:\s*(\d+)/i),_0x39bf78=_0x3314db[_0x454eaa(0x23a)](/Дата рождения:\s*([\d\.]+)/i),_0x4c3d05=_0x3314db['match'](/Руководитель:\s*([\u0400-\u04FF\s\-]+)/i),_0x5cb392=_0x3314db[_0x454eaa(0x23a)](/Почтовый домен:\s*([\w\.\-]+)/i);if(_0x570934)_0x5da177[_0x454eaa(0x208)]=_0x570934[0x1];if(_0x5d59c2)_0x5da177[_0x454eaa(0x23b)]=_0x5593d3(_0x5d59c2[0x1]);if(_0x39bf78)_0x5da177[_0x454eaa(0x21c)]=_0x39bf78[0x1];if(_0x4c3d05)_0x5da177['manager']=_0x4c3d05[0x1][_0x454eaa(0x235)]();if(_0x5cb392){const _0xd36b61=_0x5cb392[0x1][_0x454eaa(0x23e)](),_0x46190d={'pointsgroup.ru':_0x454eaa(0x201),'arenamb.ru':_0x454eaa(0x222),'advgroup.ru':'ADV','advbenchmark.ru':_0x454eaa(0x216),'advdigital.ru':'ADV\x20Digital','advperformance.ru':_0x454eaa(0x228),'initiativemedia.ru':_0x454eaa(0x1f6),'otc24.ru':_0x454eaa(0x224),'umww.ru':'UM','advecomm.ru':_0x454eaa(0x231),'advelop.ru':_0x454eaa(0x236)};_0x5da177[_0x454eaa(0x213)]=_0x46190d[_0xd36b61]||'';}return _0x5da177;}function _0x331e65(_0x1edd11){const _0x3a69f0=_0x3767;if(!_0x1edd11['account']||!_0x1edd11[_0x3a69f0(0x23b)]||!_0x1edd11['birth_date']||!_0x1edd11[_0x3a69f0(0x203)])return'Ошибка:\x20Не\x20найдены\x20необходимые\x20поля\x20в\x20заявке.';let _0x12b5f7=_0x3b304b(_0x1edd11[_0x3a69f0(0x203)]),_0x125b60=_0x3a69f0(0x233)+_0x12b5f7+_0x3a69f0(0x1ff)+_0x1edd11['account']+_0x3a69f0(0x20a)+_0x1edd11[_0x3a69f0(0x23b)]+_0x3a69f0(0x237)+_0x1edd11['birth_date']+_0x3a69f0(0x234)+_0x1edd11[_0x3a69f0(0x213)]+_0x3a69f0(0x22d)+_0x1edd11[_0x3a69f0(0x208)]+_0x3a69f0(0x20a)+_0x1edd11[_0x3a69f0(0x23b)]+_0x3a69f0(0x237)+_0x1edd11[_0x3a69f0(0x21c)]+'\x27;\x20company=\x27'+_0x1edd11[_0x3a69f0(0x213)]+'\x27}\x0a\x20\x20\x20\x20\x20\x20\x20\x20Write-Host\x20\x22Attributes\x20edited\x20(!CHECK\x20MANAGER!).\x22\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20Set-ADAccountPassword\x20-Identity\x20\x27'+_0x1edd11[_0x3a69f0(0x208)]+'\x27\x20-NewPassword\x20(ConvertTo-SecureString\x20\x22123qwe!@#\x22\x20-AsPlainText\x20-Force)\x20-Reset\x0a\x20\x20\x20\x20Write-Host\x20\x22User\x20password\x20successfully\x20set.\x22\x0a\x0a\x20\x20\x20\x20Enable-ADAccount\x20-Identity\x20\x27'+_0x1edd11[_0x3a69f0(0x208)]+_0x3a69f0(0x1f2)+_0x1edd11[_0x3a69f0(0x208)]+'\x27\x0a\x20\x20\x20\x20Write-Host\x20\x22User\x20added\x20to\x20SG-G-AnyconnectUsers.\x22\x0a}\x20catch\x20{\x0a\x20\x20\x20\x20Write-Error\x20$_\x0a\x20\x20\x20\x20Read-Host\x20-Prompt\x20\x22Error.\x20Press\x20Enter\x20to\x20exit\x22\x0a\x20\x20\x20\x20exit\x201\x0a}\x0a';return _0x125b60['trim']();}function _0x4dbf37(){const _0x74f77e=_0x3767,_0x5c12ca=document[_0x74f77e(0x229)](_0x74f77e(0x1f7));if(!_0x5c12ca)return;const _0x3b0d9a=_0x5c12ca[_0x74f77e(0x229)](_0x74f77e(0x1f1));if(!_0x3b0d9a||!/выход нового сотрудника/i[_0x74f77e(0x1eb)](_0x3b0d9a[_0x74f77e(0x20c)]))return;const _0x2fc4a6=_0x5c12ca[_0x74f77e(0x229)]('.rich_text_container');if(!_0x2fc4a6)return;if(_0x5c12ca[_0x74f77e(0x229)]('.edit-ps-container'))return;const _0x2882e6=document[_0x74f77e(0x1ea)](_0x74f77e(0x207));_0x2882e6['classList'][_0x74f77e(0x202)](_0x74f77e(0x214)),_0x2882e6[_0x74f77e(0x204)][_0x74f77e(0x227)]=_0x74f77e(0x1ed),_0x2882e6[_0x74f77e(0x204)]['alignItems']='center',_0x2882e6[_0x74f77e(0x204)][_0x74f77e(0x1f9)]=_0x74f77e(0x226),_0x2882e6['style']['marginTop']=_0x74f77e(0x226);const _0x3adf15=document[_0x74f77e(0x1ea)]('button');_0x3adf15['textContent']=_0x74f77e(0x1f4),_0x3adf15[_0x74f77e(0x204)][_0x74f77e(0x217)]=_0x74f77e(0x1fd);const _0x1ec2cc=document['createElement'](_0x74f77e(0x1fb));_0x1ec2cc[_0x74f77e(0x204)]['background']=_0x74f77e(0x221),_0x1ec2cc[_0x74f77e(0x204)][_0x74f77e(0x1fc)]=_0x74f77e(0x1ec),_0x1ec2cc[_0x74f77e(0x204)][_0x74f77e(0x20f)]=_0x74f77e(0x226),_0x1ec2cc[_0x74f77e(0x204)][_0x74f77e(0x21b)]='pre-wrap',_0x1ec2cc[_0x74f77e(0x204)][_0x74f77e(0x1f5)]='0',_0x1ec2cc['style']['minWidth']=_0x74f77e(0x220),_0x1ec2cc[_0x74f77e(0x204)]['maxWidth']='600px',_0x1ec2cc['style'][_0x74f77e(0x22a)]='auto',_0x1ec2cc[_0x74f77e(0x204)]['display']='none',_0x1ec2cc[_0x74f77e(0x204)][_0x74f77e(0x22e)]=_0x74f77e(0x23d),_0x1ec2cc[_0x74f77e(0x204)][_0x74f77e(0x239)]=_0x74f77e(0x225);const _0xb1c7c8=document['createElement'](_0x74f77e(0x200));_0xb1c7c8[_0x74f77e(0x20c)]=_0x74f77e(0x1f3),_0xb1c7c8[_0x74f77e(0x204)][_0x74f77e(0x217)]=_0x74f77e(0x1fd),_0xb1c7c8[_0x74f77e(0x204)][_0x74f77e(0x218)]='0',_0xb1c7c8[_0x74f77e(0x204)][_0x74f77e(0x227)]=_0x74f77e(0x206),_0xb1c7c8[_0x74f77e(0x1fe)](_0x74f77e(0x20b),()=>{const _0x3d1a8c=_0x74f77e;_0x1ec2cc[_0x3d1a8c(0x20c)]['trim']()&&navigator[_0x3d1a8c(0x210)][_0x3d1a8c(0x212)](_0x1ec2cc[_0x3d1a8c(0x20c)])[_0x3d1a8c(0x205)](()=>{const _0x4e7c6a=_0x3d1a8c;_0xb1c7c8[_0x4e7c6a(0x20c)]=_0x4e7c6a(0x22b),setTimeout(()=>{const _0x12c4de=_0x4e7c6a;_0xb1c7c8[_0x12c4de(0x20c)]='Copy';},0x7d0);})[_0x3d1a8c(0x230)](()=>{const _0xca1dd5=_0x3d1a8c;alert(_0xca1dd5(0x1fa));});}),_0x2882e6[_0x74f77e(0x211)](_0x3adf15),_0x2882e6[_0x74f77e(0x211)](_0x1ec2cc),_0x2882e6[_0x74f77e(0x211)](_0xb1c7c8),_0x2fc4a6['insertAdjacentElement']('afterend',_0x2882e6),_0x3adf15[_0x74f77e(0x1fe)]('click',()=>{const _0x3eecd8=_0x74f77e;if(_0x1ec2cc[_0x3eecd8(0x204)][_0x3eecd8(0x227)]==='block')_0x1ec2cc[_0x3eecd8(0x204)][_0x3eecd8(0x227)]='none',_0xb1c7c8[_0x3eecd8(0x204)][_0x3eecd8(0x227)]='none';else{const _0x16f9d4=_0x5c12ca[_0x3eecd8(0x21f)],_0x6f9106=_0x3471a5(_0x16f9d4),_0x1a303e=_0x331e65(_0x6f9106);_0x1ec2cc[_0x3eecd8(0x20c)]=_0x1a303e,_0x1ec2cc[_0x3eecd8(0x204)]['display']=_0x3eecd8(0x23c),_0xb1c7c8[_0x3eecd8(0x204)][_0x3eecd8(0x227)]=_0x3eecd8(0x1f8);}});}window['addEventListener']('load',()=>{setTimeout(_0x4dbf37,0x3e8);});}()));
