// ==UserScript==
// @name         Edit AD user .PS
// @namespace    https://sqaaq.github.io/automations
// @version      1.12
// @description  Кнопка появляется только при наличии "Выход нового сотрудника" в заголовке + FullAutoAnswer + Passw gen + mailbox create
// @author       Egor & AI
// @match        https://*/front/ticket.form.php?*
// @downloadURL  https://sqaaq.github.io/automations/userscripts/editADuser.user.js
// @updateURL    https://sqaaq.github.io/automations/userscripts/editADuser.meta.js
// @grant        none
// ==/UserScript==

function _0x5af3(_0x2b5c30,_0x3733ea){_0x2b5c30=_0x2b5c30-0x166;const _0x38a299=_0x38a2();let _0x5af368=_0x38a299[_0x2b5c30];return _0x5af368;}function _0x38a2(){const _0x201c04=['Initiative','+7\x20','EditADuser.PS','border','addEventListener','padding','1588951KWhjPR','innerHTML','div','25px','manager','textContent','1887750XaUNWt','width','column','gap','@advmoscow.ru<br>\x0aПароль:\x20','display','328DOblTO','cursor','pointer','.rich_text_container','appendChild','classList','company','alignItems','200px','pre','push','\x27\x0a\x0a$Session\x20=\x20New-PSSession\x20-ConfigurationName\x20Microsoft.Exchange\x20-ConnectionUri\x20http://DC1-EXCH-02.advmoscow.ru/PowerShell/\x20-Authentication\x20Kerberos\x0aImport-PSSession\x20$Session\x0aEnable-Mailbox\x20-Identity\x20\x27','ADV\x20Digital','floor','\x27\x0a$ADUser.extensionAttribute1=\x27','trim','whiteSpace','slice','#f0f0f0','Кнопка\x20\x22Ответ\x22\x20не\x20найдена','justifyContent','toLowerCase','Ошибка:\x20Не\x20найдены\x20необходимые\x20поля\x20в\x20заявке.','contentWindow','random','10px','innerText','afterend','65829NRIoQk','1px\x20solid\x20#ccc','minWidth','\x22\x20-AsPlainText\x20-Force)\x20-Reset\x0aAdd-ADGroupMember\x20-Identity\x20\x22SG-G-AnyconnectUsers\x22\x20-Members\x20\x27','Points','inline-block','createElement','flex-start','body','\x27\x20-Properties\x20company,\x20manager,\x20extensionAttribute1,\x20mobile\x0a$ADUser.company\x20=\x20\x27','auto','pre-wrap','541304lNTzQW','Copy.PS','domain','button','none','\x0a$Managers\x20=\x20Get-ADUser\x20-Filter\x20{\x20info\x20-like\x20\x22*','\x27\x20-NewPassword\x20(ConvertTo-SecureString\x20\x22','replace','\x27\x0a$ADUser.mobile\x20=\x20\x27','phone','217746gpfjYj','ADV\x20Performance','63008cwdXVj','Copied!','center','Не\x20найдено\x20поле\x20ввода','birth_date','querySelector','fio','load','click','document','match','10VcxxtT','join','edit-ps-container','toUpperCase','\x27\x20|\x20Select-Object\x20DisplayName,PrimarySmtpAddress\x20|\x20Format-List\x0aRemove-PSSession\x20$Session\x0a\x0a','1\x201\x20auto','\x27\x0a\x0aif\x20($PrimaryManager)\x20{\x0a\x20\x20\x20\x20$ADUser.manager\x20=\x20\x20$PrimaryManager.DistinguishedName\x0a}\x20else\x20{\x0a\x20\x20\x20\x20Write-Host\x20\x22NO\x20MANAGERS\x20SET\x20TO\x20USER,\x20CHECK\x20MANAGER\x22\x0a}\x0a\x20\x0aSet-ADUser\x20-Instance\x20$ADUser\x0a\x0aWrite-Host\x20\x22DON\x27T\x20FORGET\x20TO\x20CHANGE\x20USER\x20OU\x22\x0a\x0aSet-ADAccountPassword\x20-Identity\x20\x27','maxHeight','120px','100px','.edit-ps-container','overflowY','maxWidth','<br><br>\x0aНоутбук\x20|\x20rds.advmoscow.ru\x20|\x20Удаленный\x20рабочий\x20стол<br>\x0aЛогин:\x20advmoscow\x5c','contentDocument','marginTop','account','length','abcdefghjkmnpqrstuvwxyz','style','3UUVemd','block','flex','startsWith','then','iframe[id^=\x22content_\x22]','ADV\x20eCommerce','ADV\x20Benchmark','useremail','.card-title.card-header.mx-n3.mt-n3','add','<br><br>\x0aВход\x20в\x20Яндекс\x20Мессенджер,\x20Телемост,\x20Диск:<br>\x0aЛогин:\x20','writeText','flexDirection','23456789','test','AutoAnswer','12870dDeXSZ','background'];_0x38a2=function(){return _0x201c04;};return _0x38a2();}(function(_0xd95808,_0x2a1b9e){const _0x4b6c1d=_0x5af3,_0x2cac71=_0xd95808();while(!![]){try{const _0x45cec4=-parseInt(_0x4b6c1d(0x189))/0x1+parseInt(_0x4b6c1d(0x1a1))/0x2+-parseInt(_0x4b6c1d(0x1c0))/0x3*(-parseInt(_0x4b6c1d(0x195))/0x4)+-parseInt(_0x4b6c1d(0x1ac))/0x5*(parseInt(_0x4b6c1d(0x19f))/0x6)+parseInt(_0x4b6c1d(0x1d9))/0x7+-parseInt(_0x4b6c1d(0x16d))/0x8*(-parseInt(_0x4b6c1d(0x1d1))/0x9)+-parseInt(_0x4b6c1d(0x167))/0xa;if(_0x45cec4===_0x2a1b9e)break;else _0x2cac71['push'](_0x2cac71['shift']());}catch(_0x311d7d){_0x2cac71['push'](_0x2cac71['shift']());}}}(_0x38a2,0x1e953),(function(){'use strict';const _0x4c3e51=_0x5af3;function _0x510325(_0xa446ac){const _0x2bbcf1=_0x5af3;let _0xcd0f7=_0xa446ac[_0x2bbcf1(0x19c)](/\D/g,'');if(_0xcd0f7[_0x2bbcf1(0x1c3)]('8')&&_0xcd0f7[_0x2bbcf1(0x1bd)]===0xb)_0xcd0f7='7'+_0xcd0f7[_0x2bbcf1(0x17e)](0x1);else{if(_0xcd0f7['startsWith']('9')&&_0xcd0f7[_0x2bbcf1(0x1bd)]===0xa)_0xcd0f7='7'+_0xcd0f7;else{if(_0xcd0f7[_0x2bbcf1(0x1c3)]('+7')){_0xcd0f7=_0xcd0f7[_0x2bbcf1(0x17e)](0x2);if(_0xcd0f7[_0x2bbcf1(0x1bd)]===0xa)_0xcd0f7='7'+_0xcd0f7;}}}if(_0xcd0f7[_0x2bbcf1(0x1bd)]===0xb&&_0xcd0f7['startsWith']('7'))return _0x2bbcf1(0x1d4)+_0xcd0f7[_0x2bbcf1(0x17e)](0x1,0x4)+'\x20'+_0xcd0f7[_0x2bbcf1(0x17e)](0x4,0x7)+'\x20'+_0xcd0f7[_0x2bbcf1(0x17e)](0x7,0x9)+'\x20'+_0xcd0f7['slice'](0x9,0xb);return _0xa446ac;}function _0x42cdd8(_0x3086e4=0xc){const _0x15133d=_0x5af3,_0x1c9c5d='ABCDEFGHJKLMNPQRSTUVWXYZ',_0x331299=_0x15133d(0x1be),_0x11b1bb=_0x15133d(0x1ce),_0x429e92=_0x1c9c5d+_0x331299+_0x11b1bb;let _0x2c5615=[_0x1c9c5d[Math[_0x15133d(0x17a)](Math['random']()*_0x1c9c5d[_0x15133d(0x1bd)])],_0x331299[Math['floor'](Math['random']()*_0x331299[_0x15133d(0x1bd)])],_0x11b1bb[Math['floor'](Math[_0x15133d(0x185)]()*_0x11b1bb[_0x15133d(0x1bd)])]];for(let _0x45766e=0x3;_0x45766e<_0x3086e4;_0x45766e++){_0x2c5615[_0x15133d(0x177)](_0x429e92[Math[_0x15133d(0x17a)](Math[_0x15133d(0x185)]()*_0x429e92['length'])]);}for(let _0x491287=_0x2c5615[_0x15133d(0x1bd)]-0x1;_0x491287>0x0;_0x491287--){const _0x288a77=Math[_0x15133d(0x17a)](Math[_0x15133d(0x185)]()*(_0x491287+0x1));[_0x2c5615[_0x491287],_0x2c5615[_0x288a77]]=[_0x2c5615[_0x288a77],_0x2c5615[_0x491287]];}return _0x2c5615[_0x15133d(0x1ad)]('');}const _0x246662=_0x42cdd8();function _0x190519(_0x5cda1e){const _0x371986=_0x5af3;let _0x280f79=_0x5cda1e['trim']()['split'](/\s+/);if(_0x280f79[_0x371986(0x1bd)]>=0x2)return _0x280f79[0x1]+'\x20'+_0x280f79[0x0];return _0x5cda1e;}function _0x5c1424(_0x5c4e92){const _0x866ec0=_0x5af3;if(!_0x5c4e92||!_0x5c4e92['length'])return'';return _0x5c4e92[0x0][_0x866ec0(0x1af)]()+_0x5c4e92[_0x866ec0(0x17e)](0x1)[_0x866ec0(0x182)]();}function _0x29dd58(_0x15d08a,_0x106953){const _0x546a4c=_0x5af3;let _0x5e0ebb=_0x15d08a[_0x546a4c(0x17c)]()['split'](/\s+/);if(_0x5e0ebb['length']<0x2)return'';let _0x250091=_0x5c1424(_0x5e0ebb[0x1]),_0x2c0a19=_0x5c1424(_0x5e0ebb[0x0]);return _0x250091+'.'+_0x2c0a19+'@'+_0x106953;}function _0x68de90(_0x12b672){const _0x404a15=_0x5af3;let _0x330f62={},_0x55a082=_0x12b672[_0x404a15(0x1ab)](/учетная запись\s+(\w+)/i),_0xaf0c09=_0x12b672['match'](/Телефон:\s*(\d+)/i),_0x1c102e=_0x12b672[_0x404a15(0x1ab)](/Дата рождения:\s*([\d\.]+)/i),_0x408293=_0x12b672[_0x404a15(0x1ab)](/Руководитель:\s*([\u0400-\u04FF\s\-]+)/i),_0x45d7ec=_0x12b672[_0x404a15(0x1ab)](/Почтовый домен:\s*([\w\.\-]+)/i),_0x2decbd=_0x12b672[_0x404a15(0x1ab)](/Фамилия\/имя:\s*([A-Za-zА-Яа-яЁё\s\-]+)/i);if(_0x55a082)_0x330f62['account']=_0x55a082[0x1];if(_0xaf0c09)_0x330f62[_0x404a15(0x19e)]=_0x510325(_0xaf0c09[0x1]);if(_0x1c102e)_0x330f62[_0x404a15(0x1a5)]=_0x1c102e[0x1];if(_0x408293)_0x330f62[_0x404a15(0x1dd)]=_0x408293[0x1][_0x404a15(0x17c)]();if(_0x45d7ec){let _0xb90504=_0x45d7ec[0x1][_0x404a15(0x182)]();_0xb90504[_0x404a15(0x1c3)]('@')&&(_0xb90504=_0xb90504[_0x404a15(0x17e)](0x1));const _0x1c9908={'pointsgroup.ru':_0x404a15(0x18d),'arenamb.ru':'Arena','advgroup.ru':'ADV','advbenchmark.ru':_0x404a15(0x1c7),'advdigital.ru':_0x404a15(0x179),'advperformance.ru':_0x404a15(0x1a0),'initiativemedia.ru':_0x404a15(0x1d3),'otc24.ru':'OTC','umww.ru':'UM','advecomm.ru':_0x404a15(0x1c6),'advelop.ru':'ADVelop'};_0x330f62[_0x404a15(0x173)]=_0x1c9908[_0xb90504]||'',_0x330f62[_0x404a15(0x197)]=_0xb90504;}return _0x2decbd&&_0x45d7ec&&(_0x330f62['fio']=_0x2decbd[0x1]['trim'](),_0x330f62[_0x404a15(0x1c8)]=_0x29dd58(_0x330f62[_0x404a15(0x1a7)],_0x330f62[_0x404a15(0x197)])),_0x330f62;}function _0x11fb83(_0x33369b){const _0x34f0e1=_0x5af3;if(!_0x33369b[_0x34f0e1(0x1bc)]||!_0x33369b[_0x34f0e1(0x19e)]||!_0x33369b[_0x34f0e1(0x1a5)]||!_0x33369b['manager'])return _0x34f0e1(0x183);let _0x5a5196=_0x190519(_0x33369b[_0x34f0e1(0x1dd)]);return(_0x34f0e1(0x19a)+_0x5a5196+'*\x22\x20}\x0a$PrimaryManager\x20=\x20($Managers\x20|\x20Where-Object\x20{\x20$_.DistinguishedName\x20-notlike\x20\x22*,OU=AdditionalMailboxes,*\x22\x20})\x20|\x20Select-Object\x20-First\x201\x0a\x0a$ADUser\x20=\x20Get-ADUser\x20\x27'+_0x33369b[_0x34f0e1(0x1bc)]+_0x34f0e1(0x192)+_0x33369b[_0x34f0e1(0x173)]+_0x34f0e1(0x19d)+_0x33369b[_0x34f0e1(0x19e)]+_0x34f0e1(0x17b)+_0x33369b[_0x34f0e1(0x1a5)]+_0x34f0e1(0x1b2)+_0x33369b[_0x34f0e1(0x1bc)]+_0x34f0e1(0x19b)+_0x246662+_0x34f0e1(0x18c)+_0x33369b[_0x34f0e1(0x1bc)]+'\x27\x0aEnable-ADAccount\x20-Identity\x20\x27'+_0x33369b['account']+_0x34f0e1(0x178)+_0x33369b[_0x34f0e1(0x1bc)]+'\x27\x0aGet-Mailbox\x20-Identity\x20\x27'+_0x33369b['account']+_0x34f0e1(0x1b0))['trim']();}function _0x30ca7a(){return new Promise(_0x1a4e0d=>{const _0x4634b0=()=>{const _0x39ce34=_0x5af3,_0x5d05bd=document[_0x39ce34(0x1a6)](_0x39ce34(0x1c5));if(_0x5d05bd)_0x1a4e0d(_0x5d05bd);else setTimeout(_0x4634b0,0x1f4);};_0x4634b0();});}function _0x5f10a8(){const _0x36fe51=_0x5af3,_0x26502d=document[_0x36fe51(0x1a6)]('.mt-2.timeline-content.left.card');if(!_0x26502d)return;const _0x416c61=_0x26502d[_0x36fe51(0x1a6)](_0x36fe51(0x1c9));if(!_0x416c61||!/выход нового сотрудника/i[_0x36fe51(0x1cf)](_0x416c61[_0x36fe51(0x166)]))return;const _0x33b3a1=_0x26502d[_0x36fe51(0x1a6)](_0x36fe51(0x170));if(!_0x33b3a1||_0x26502d[_0x36fe51(0x1a6)](_0x36fe51(0x1b6)))return;const _0x2f895a=_0x26502d[_0x36fe51(0x187)],_0x4612b4=_0x68de90(_0x2f895a),_0x48f4f9=document['createElement'](_0x36fe51(0x1db));_0x48f4f9[_0x36fe51(0x172)][_0x36fe51(0x1ca)](_0x36fe51(0x1ae)),_0x48f4f9[_0x36fe51(0x1bf)][_0x36fe51(0x16c)]=_0x36fe51(0x1c2),_0x48f4f9[_0x36fe51(0x1bf)][_0x36fe51(0x174)]=_0x36fe51(0x190),_0x48f4f9['style'][_0x36fe51(0x16a)]=_0x36fe51(0x1dc),_0x48f4f9[_0x36fe51(0x1bf)][_0x36fe51(0x1bb)]=_0x36fe51(0x186);const _0x915be6=document[_0x36fe51(0x18f)](_0x36fe51(0x1db));_0x915be6[_0x36fe51(0x1bf)][_0x36fe51(0x16c)]=_0x36fe51(0x1c2),_0x915be6[_0x36fe51(0x1bf)][_0x36fe51(0x1cd)]='column',_0x915be6['style'][_0x36fe51(0x181)]=_0x36fe51(0x190),_0x915be6[_0x36fe51(0x1bf)][_0x36fe51(0x174)]='center';const _0x4e8bab=document[_0x36fe51(0x18f)](_0x36fe51(0x198));_0x4e8bab[_0x36fe51(0x166)]=_0x36fe51(0x1d5),_0x4e8bab[_0x36fe51(0x1bf)][_0x36fe51(0x16e)]=_0x36fe51(0x16f),_0x4e8bab['style'][_0x36fe51(0x168)]=_0x36fe51(0x1b4),_0x915be6['appendChild'](_0x4e8bab);const _0x15f876=document['createElement'](_0x36fe51(0x1db));_0x15f876[_0x36fe51(0x1bf)][_0x36fe51(0x1c2)]=_0x36fe51(0x1b1);const _0x18fa68=document['createElement'](_0x36fe51(0x176));_0x18fa68[_0x36fe51(0x1bf)][_0x36fe51(0x1d2)]=_0x36fe51(0x17f),_0x18fa68[_0x36fe51(0x1bf)][_0x36fe51(0x1d6)]=_0x36fe51(0x18a),_0x18fa68[_0x36fe51(0x1bf)][_0x36fe51(0x1d8)]=_0x36fe51(0x186),_0x18fa68[_0x36fe51(0x1bf)][_0x36fe51(0x17d)]=_0x36fe51(0x194),_0x18fa68[_0x36fe51(0x1bf)]['margin']='0',_0x18fa68[_0x36fe51(0x1bf)][_0x36fe51(0x18b)]='300px',_0x18fa68['style'][_0x36fe51(0x1b8)]='600px',_0x18fa68[_0x36fe51(0x1bf)][_0x36fe51(0x16c)]=_0x36fe51(0x199),_0x18fa68[_0x36fe51(0x1bf)][_0x36fe51(0x1b3)]=_0x36fe51(0x175),_0x18fa68['style'][_0x36fe51(0x1b7)]=_0x36fe51(0x193),_0x15f876['appendChild'](_0x18fa68);const _0x36dd81=document[_0x36fe51(0x18f)]('div');_0x36dd81[_0x36fe51(0x1bf)][_0x36fe51(0x16c)]='flex',_0x36dd81[_0x36fe51(0x1bf)][_0x36fe51(0x1cd)]=_0x36fe51(0x169),_0x36dd81[_0x36fe51(0x1bf)]['justifyContent']=_0x36fe51(0x190),_0x36dd81[_0x36fe51(0x1bf)][_0x36fe51(0x174)]=_0x36fe51(0x1a3),_0x36dd81['style'][_0x36fe51(0x16a)]=_0x36fe51(0x186);const _0x5402f7=document[_0x36fe51(0x18f)](_0x36fe51(0x198));_0x5402f7[_0x36fe51(0x166)]=_0x36fe51(0x1d0),_0x5402f7['style']['cursor']=_0x36fe51(0x16f),_0x5402f7[_0x36fe51(0x1bf)][_0x36fe51(0x168)]=_0x36fe51(0x1b5),_0x36dd81[_0x36fe51(0x171)](_0x5402f7);const _0x3e68c2=document['createElement']('button');_0x3e68c2['textContent']=_0x36fe51(0x196),_0x3e68c2[_0x36fe51(0x1bf)][_0x36fe51(0x16e)]=_0x36fe51(0x16f),_0x3e68c2['style'][_0x36fe51(0x16c)]=_0x36fe51(0x199),_0x3e68c2[_0x36fe51(0x1bf)][_0x36fe51(0x168)]=_0x36fe51(0x1b5),_0x36dd81[_0x36fe51(0x171)](_0x3e68c2),_0x4e8bab['addEventListener'](_0x36fe51(0x1a9),()=>{const _0x4bf1c4=_0x36fe51;if(_0x18fa68[_0x4bf1c4(0x1bf)][_0x4bf1c4(0x16c)]===_0x4bf1c4(0x1c1))_0x18fa68[_0x4bf1c4(0x1bf)][_0x4bf1c4(0x16c)]=_0x4bf1c4(0x199),_0x3e68c2[_0x4bf1c4(0x1bf)]['display']='none';else{const _0x27f652=_0x11fb83(_0x4612b4);_0x18fa68[_0x4bf1c4(0x166)]=_0x27f652,_0x18fa68[_0x4bf1c4(0x1bf)]['display']='block',_0x3e68c2[_0x4bf1c4(0x1bf)][_0x4bf1c4(0x16c)]=_0x4bf1c4(0x18e);}}),_0x3e68c2[_0x36fe51(0x1d7)]('click',()=>{const _0x3c0b5c=_0x36fe51;_0x18fa68[_0x3c0b5c(0x166)][_0x3c0b5c(0x17c)]()&&navigator['clipboard'][_0x3c0b5c(0x1cc)](_0x18fa68[_0x3c0b5c(0x166)])[_0x3c0b5c(0x1c4)](()=>{const _0x57d97=_0x3c0b5c;_0x3e68c2['textContent']=_0x57d97(0x1a2),setTimeout(()=>{const _0x67498b=_0x57d97;_0x3e68c2[_0x67498b(0x166)]='Copy';},0x7d0);});}),_0x5402f7[_0x36fe51(0x1d7)](_0x36fe51(0x1a9),async()=>{const _0x4327e8=_0x36fe51,_0x1d9112=document['querySelector']('button.answer-action');if(_0x1d9112)_0x1d9112['click']();else{alert(_0x4327e8(0x180));return;}const _0x4500b7=await _0x30ca7a();if(_0x4500b7){const _0x216c03=_0x4500b7[_0x4327e8(0x1ba)]||_0x4500b7[_0x4327e8(0x184)][_0x4327e8(0x1aa)];_0x216c03[_0x4327e8(0x191)][_0x4327e8(0x1da)]='\x0aДобрый\x20день!<br>\x0aУчетная\x20запись\x20создана.<br>\x0aПочта:\x20'+_0x4612b4[_0x4327e8(0x1c8)]+_0x4327e8(0x1cb)+_0x4612b4[_0x4327e8(0x1bc)]+_0x4327e8(0x16b)+_0x246662+_0x4327e8(0x1b9)+_0x4612b4[_0x4327e8(0x1bc)]+'<br>\x0aПароль:\x20'+_0x246662;}else alert(_0x4327e8(0x1a4));}),_0x48f4f9[_0x36fe51(0x171)](_0x915be6),_0x48f4f9[_0x36fe51(0x171)](_0x15f876),_0x48f4f9[_0x36fe51(0x171)](_0x36dd81),_0x33b3a1['insertAdjacentElement'](_0x36fe51(0x188),_0x48f4f9);}window[_0x4c3e51(0x1d7)](_0x4c3e51(0x1a8),()=>{setTimeout(_0x5f10a8,0x3e8);});}()));
