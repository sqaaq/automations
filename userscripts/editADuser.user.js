// ==UserScript==
// @name         Edit AD user .PS
// @namespace    https://sqaaq.github.io/automations
// @version      1.11
// @description  Кнопка появляется только при наличии "Выход нового сотрудника" в заголовке + FullAutoAnswer + Passw gen + mailbox create
// @author       Egor & AI
// @match        https://*/front/ticket.form.php?*
// @downloadURL  https://sqaaq.github.io/automations/userscripts/editADuser.user.js
// @updateURL    https://sqaaq.github.io/automations/userscripts/editADuser.meta.js
// @grant        none
// ==/UserScript==

function _0x2b96(_0x494bf7,_0x372af9){const _0x48a33a=_0x48a3();return _0x2b96=function(_0x2b967d,_0x28e0fa){_0x2b967d=_0x2b967d-0xb4;let _0xf46f93=_0x48a33a[_0x2b967d];return _0xf46f93;},_0x2b96(_0x494bf7,_0x372af9);}function _0x48a3(){const _0x1493d7=['manager','23456789','633825strcpC','iframe[id^=\x22content_\x22]','edit-ps-container','\x27\x20|\x20Select-Object\x20DisplayName,PrimarySmtpAddress\x20|\x20Format-List\x0aRemove-PSSession\x20$Session\x0aWrite-Output\x20\x22DON\x27T\x20FORGET\x20TO\x20CHANGE\x20USER\x20OU\x22\x0a','style','Не\x20найдено\x20поле\x20ввода','random','\x27}\x0a}\x0a\x0aSet-ADAccountPassword\x20-Identity\x20\x27','ADV\x20Benchmark','contentWindow','flexDirection','Copied!','trim','pre-wrap','test','split','innerHTML','.mt-2.timeline-content.left.card','floor','startsWith','200px','Copy.PS','12hWFvlK','contentDocument','div','account','then','Кнопка\x20\x22Ответ\x22\x20не\x20найдена','@advmoscow.ru<br>\x0aПароль:\x20','\x27\x20-NewPassword\x20(ConvertTo-SecureString\x20\x22','toUpperCase','join','minWidth','domain','201949ohQGMl','AutoAnswer','maxWidth','\x27;\x20company=\x27','300px','textContent','.card-title.card-header.mx-n3.mt-n3','justifyContent','click','\x27\x0aGet-Mailbox\x20-Identity\x20\x27','ADVelop','body','1px\x20solid\x20#ccc','load','ABCDEFGHJKLMNPQRSTUVWXYZ','slice','<br><br>\x0aНоутбук\x20|\x20rds.advmoscow.ru\x20|\x20Удаленный\x20рабочий\x20стол<br>\x0aЛогин:\x20advmoscow\x5c','206521dPKVZY','385vxSZRw','pointer','10px','flex','gap','\x27\x0a$Session\x20=\x20New-PSSession\x20-ConfigurationName\x20Microsoft.Exchange\x20-ConnectionUri\x20http://DC1-EXCH-02.advmoscow.ru/PowerShell/\x20-Authentication\x20Kerberos\x0aImport-PSSession\x20$Session\x0aEnable-Mailbox\x20-Identity\x20\x27','\x22\x20-AsPlainText\x20-Force)\x20-Reset\x0aEnable-ADAccount\x20-Identity\x20\x27','add','\x27\x0aAdd-ADGroupMember\x20-Identity\x20\x22SG-G-AnyconnectUsers\x22\x20-Members\x20\x27','ADV\x20Performance','.edit-ps-container','block','company','overflowY','addEventListener','cursor','\x0aДобрый\x20день!<br>\x0aУчетная\x20запись\x20готова.<br>\x0aПочта:\x20','\x27\x20-Replace\x20@{mobile=\x27','1388128TZziri','insertAdjacentElement','alignItems','flex-start','display','none','42690GVwEhK','ADV\x20Digital','Points','155532tcmHlY','pre','button','600px','match','clipboard','length','createElement','column','maxHeight','border','inline-block','fio','margin','\x27;\x20extensionAttribute1=\x27','ADV\x20eCommerce','width','25px','center','whiteSpace','72ETWunR','100px','Arena','530NxwIdM','padding','querySelector','ADV','innerText','marginTop','toLowerCase','afterend','<br>\x0aПароль:\x20','\x0a$managers\x20=\x20Get-ADUser\x20-Filter\x20{\x20info\x20-like\x20\x22*','button.answer-action','birth_date','120px','appendChild','phone','OTC','\x27}\x20-Manager\x20$managerDN\x0a}\x20else\x20{\x0a\x20\x20\x20\x20Set-ADUser\x20-Identity\x20\x27','16364eIDQfp','document'];_0x48a3=function(){return _0x1493d7;};return _0x48a3();}(function(_0x3d1ba2,_0x116693){const _0x4dba05=_0x2b96,_0xe77770=_0x3d1ba2();while(!![]){try{const _0xaff61f=-parseInt(_0x4dba05(0xb8))/0x1+-parseInt(_0x4dba05(0xbb))/0x2*(parseInt(_0x4dba05(0xfd))/0x3)+-parseInt(_0x4dba05(0xe3))/0x4*(parseInt(_0x4dba05(0x11b))/0x5)+-parseInt(_0x4dba05(0xcf))/0x6*(parseInt(_0x4dba05(0x11a))/0x7)+parseInt(_0x4dba05(0x12d))/0x8+parseInt(_0x4dba05(0xe7))/0x9+-parseInt(_0x4dba05(0xd2))/0xa*(-parseInt(_0x4dba05(0x109))/0xb);if(_0xaff61f===_0x116693)break;else _0xe77770['push'](_0xe77770['shift']());}catch(_0x46a9a4){_0xe77770['push'](_0xe77770['shift']());}}}(_0x48a3,0x2f67b),(function(){'use strict';const _0x1ff462=_0x2b96;function _0x2b1669(_0x3a713e){const _0x31056a=_0x2b96;let _0x34eadf=_0x3a713e['replace'](/\D/g,'');if(_0x34eadf[_0x31056a(0xfa)]('8')&&_0x34eadf[_0x31056a(0xc1)]===0xb)_0x34eadf='7'+_0x34eadf[_0x31056a(0x118)](0x1);else{if(_0x34eadf['startsWith']('9')&&_0x34eadf['length']===0xa)_0x34eadf='7'+_0x34eadf;else{if(_0x34eadf['startsWith']('+7')){_0x34eadf=_0x34eadf['slice'](0x2);if(_0x34eadf['length']===0xa)_0x34eadf='7'+_0x34eadf;}}}if(_0x34eadf[_0x31056a(0xc1)]===0xb&&_0x34eadf[_0x31056a(0xfa)]('7'))return'+7\x20'+_0x34eadf[_0x31056a(0x118)](0x1,0x4)+'\x20'+_0x34eadf[_0x31056a(0x118)](0x4,0x7)+'\x20'+_0x34eadf['slice'](0x7,0x9)+'\x20'+_0x34eadf['slice'](0x9,0xb);return _0x3a713e;}function _0x287ea8(_0x46449d=0x8){const _0x4d6f12=_0x2b96,_0x2b1bb8=_0x4d6f12(0x117),_0x2743f0='abcdefghjkmnpqrstuvwxyz',_0x2d2e2e=_0x4d6f12(0xe6),_0x9253f0=_0x2b1bb8+_0x2743f0+_0x2d2e2e;let _0x31e72a=[_0x2b1bb8[Math['floor'](Math[_0x4d6f12(0xed)]()*_0x2b1bb8['length'])],_0x2743f0[Math['floor'](Math[_0x4d6f12(0xed)]()*_0x2743f0[_0x4d6f12(0xc1)])],_0x2d2e2e[Math[_0x4d6f12(0xf9)](Math[_0x4d6f12(0xed)]()*_0x2d2e2e[_0x4d6f12(0xc1)])]];for(let _0x5dbc76=0x3;_0x5dbc76<_0x46449d;_0x5dbc76++){_0x31e72a['push'](_0x9253f0[Math[_0x4d6f12(0xf9)](Math[_0x4d6f12(0xed)]()*_0x9253f0[_0x4d6f12(0xc1)])]);}for(let _0x594c01=_0x31e72a[_0x4d6f12(0xc1)]-0x1;_0x594c01>0x0;_0x594c01--){const _0x451b90=Math[_0x4d6f12(0xf9)](Math[_0x4d6f12(0xed)]()*(_0x594c01+0x1));[_0x31e72a[_0x594c01],_0x31e72a[_0x451b90]]=[_0x31e72a[_0x451b90],_0x31e72a[_0x594c01]];}return _0x31e72a[_0x4d6f12(0x106)]('');}const _0x333ad3=_0x287ea8();function _0x397415(_0x4a6fe2){const _0x4c0001=_0x2b96;let _0x4eb4a6=_0x4a6fe2['trim']()[_0x4c0001(0xf6)](/\s+/);if(_0x4eb4a6[_0x4c0001(0xc1)]>=0x2)return _0x4eb4a6[0x1]+'\x20'+_0x4eb4a6[0x0];return _0x4a6fe2;}function _0x2abcc7(_0x357a64){const _0x5b6afc=_0x2b96;if(!_0x357a64||!_0x357a64[_0x5b6afc(0xc1)])return'';return _0x357a64[0x0][_0x5b6afc(0x105)]()+_0x357a64['slice'](0x1)[_0x5b6afc(0xd8)]();}function _0x5706bf(_0x5573f1,_0x3556){const _0x3f3568=_0x2b96;let _0x2b1c1b=_0x5573f1['trim']()[_0x3f3568(0xf6)](/\s+/);if(_0x2b1c1b[_0x3f3568(0xc1)]<0x2)return'';let _0x3ff69e=_0x2abcc7(_0x2b1c1b[0x1]),_0x5f5dc7=_0x2abcc7(_0x2b1c1b[0x0]);return _0x3ff69e+'.'+_0x5f5dc7+'@'+_0x3556;}function _0x3c0a61(_0x5513eb){const _0x27c0b7=_0x2b96;let _0xaf9d82={},_0x1ef341=_0x5513eb[_0x27c0b7(0xbf)](/учетная запись\s+(\w+)/i),_0x2de7b1=_0x5513eb[_0x27c0b7(0xbf)](/Телефон:\s*(\d+)/i),_0x3138b9=_0x5513eb[_0x27c0b7(0xbf)](/Дата рождения:\s*([\d\.]+)/i),_0x5a304c=_0x5513eb['match'](/Руководитель:\s*([\u0400-\u04FF\s\-]+)/i),_0x395918=_0x5513eb[_0x27c0b7(0xbf)](/Почтовый домен:\s*([\w\.\-]+)/i),_0x361ed3=_0x5513eb[_0x27c0b7(0xbf)](/Фамилия\/имя:\s*([A-Za-zА-Яа-яЁё\s\-]+)/i);if(_0x1ef341)_0xaf9d82['account']=_0x1ef341[0x1];if(_0x2de7b1)_0xaf9d82[_0x27c0b7(0xe0)]=_0x2b1669(_0x2de7b1[0x1]);if(_0x3138b9)_0xaf9d82['birth_date']=_0x3138b9[0x1];if(_0x5a304c)_0xaf9d82[_0x27c0b7(0xe5)]=_0x5a304c[0x1][_0x27c0b7(0xf3)]();if(_0x395918){const _0x386c8c=_0x395918[0x1]['toLowerCase'](),_0x1b156a={'pointsgroup.ru':_0x27c0b7(0xba),'arenamb.ru':_0x27c0b7(0xd1),'advgroup.ru':_0x27c0b7(0xd5),'advbenchmark.ru':_0x27c0b7(0xef),'advdigital.ru':_0x27c0b7(0xb9),'advperformance.ru':_0x27c0b7(0x124),'initiativemedia.ru':'Initiative','otc24.ru':_0x27c0b7(0xe1),'umww.ru':'UM','advecomm.ru':_0x27c0b7(0xca),'advelop.ru':_0x27c0b7(0x113)};_0xaf9d82[_0x27c0b7(0x127)]=_0x1b156a[_0x386c8c]||'',_0xaf9d82[_0x27c0b7(0x108)]=_0x386c8c;}return _0x361ed3&&_0x395918&&(_0xaf9d82[_0x27c0b7(0xc7)]=_0x361ed3[0x1][_0x27c0b7(0xf3)](),_0xaf9d82['useremail']=_0x5706bf(_0xaf9d82[_0x27c0b7(0xc7)],_0xaf9d82['domain'])),_0xaf9d82;}function _0x52b3de(_0x316fff){const _0xbcb0f2=_0x2b96;if(!_0x316fff[_0xbcb0f2(0x100)]||!_0x316fff[_0xbcb0f2(0xe0)]||!_0x316fff[_0xbcb0f2(0xdd)]||!_0x316fff[_0xbcb0f2(0xe5)])return'Ошибка:\x20Не\x20найдены\x20необходимые\x20поля\x20в\x20заявке.';let _0x392180=_0x397415(_0x316fff['manager']);return(_0xbcb0f2(0xdb)+_0x392180+'*\x22\x20}\x20-Properties\x20SamAccountName,\x20DistinguishedName\x0a$primaryManager\x20=\x20$managers\x20|\x20Where-Object\x20{\x20$_.SamAccountName\x20-notmatch\x20\x22^[A-Z]{3}\x5c.\x22\x20}\x20|\x20Select-Object\x20-First\x201\x0a\x0aif\x20($primaryManager\x20-ne\x20$null)\x20{\x0a\x20\x20\x20\x20$managerDN\x20=\x20$primaryManager.DistinguishedName\x0a\x20\x20\x20\x20Set-ADUser\x20-Identity\x20\x27'+_0x316fff['account']+'\x27\x20-Replace\x20@{mobile=\x27'+_0x316fff[_0xbcb0f2(0xe0)]+_0xbcb0f2(0xc9)+_0x316fff['birth_date']+_0xbcb0f2(0x10c)+_0x316fff[_0xbcb0f2(0x127)]+_0xbcb0f2(0xe2)+_0x316fff[_0xbcb0f2(0x100)]+_0xbcb0f2(0x12c)+_0x316fff[_0xbcb0f2(0xe0)]+_0xbcb0f2(0xc9)+_0x316fff[_0xbcb0f2(0xdd)]+'\x27;\x20company=\x27'+_0x316fff[_0xbcb0f2(0x127)]+_0xbcb0f2(0xee)+_0x316fff[_0xbcb0f2(0x100)]+_0xbcb0f2(0x104)+_0x333ad3+_0xbcb0f2(0x121)+_0x316fff[_0xbcb0f2(0x100)]+_0xbcb0f2(0x123)+_0x316fff[_0xbcb0f2(0x100)]+_0xbcb0f2(0x120)+_0x316fff['account']+_0xbcb0f2(0x112)+_0x316fff['account']+_0xbcb0f2(0xea))[_0xbcb0f2(0xf3)]();}function _0x38dec1(){return new Promise(_0x1d1fc6=>{const _0x1b0308=()=>{const _0x258ff9=_0x2b96,_0x43018b=document[_0x258ff9(0xd4)](_0x258ff9(0xe8));if(_0x43018b)_0x1d1fc6(_0x43018b);else setTimeout(_0x1b0308,0x1f4);};_0x1b0308();});}function _0x268b5a(){const _0x263e10=_0x2b96,_0x2ea0ac=document[_0x263e10(0xd4)](_0x263e10(0xf8));if(!_0x2ea0ac)return;const _0x464676=_0x2ea0ac[_0x263e10(0xd4)](_0x263e10(0x10f));if(!_0x464676||!/выход нового сотрудника/i[_0x263e10(0xf5)](_0x464676[_0x263e10(0x10e)]))return;const _0xeba21a=_0x2ea0ac[_0x263e10(0xd4)]('.rich_text_container');if(!_0xeba21a||_0x2ea0ac['querySelector'](_0x263e10(0x125)))return;const _0x1c062e=_0x2ea0ac[_0x263e10(0xd6)],_0x54dd06=_0x3c0a61(_0x1c062e),_0x89e072=document['createElement'](_0x263e10(0xff));_0x89e072['classList'][_0x263e10(0x122)](_0x263e10(0xe9)),_0x89e072[_0x263e10(0xeb)][_0x263e10(0xb6)]=_0x263e10(0x11e),_0x89e072['style'][_0x263e10(0xb4)]=_0x263e10(0xb5),_0x89e072[_0x263e10(0xeb)][_0x263e10(0x11f)]=_0x263e10(0xcc),_0x89e072[_0x263e10(0xeb)][_0x263e10(0xd7)]=_0x263e10(0x11d);const _0x24c027=document[_0x263e10(0xc2)](_0x263e10(0xff));_0x24c027[_0x263e10(0xeb)]['display']=_0x263e10(0x11e),_0x24c027[_0x263e10(0xeb)][_0x263e10(0xf1)]=_0x263e10(0xc3),_0x24c027['style'][_0x263e10(0x110)]=_0x263e10(0xb5),_0x24c027['style']['alignItems']=_0x263e10(0xcd);const _0x5858a0=document[_0x263e10(0xc2)](_0x263e10(0xbd));_0x5858a0['textContent']='EditADuser.PS',_0x5858a0[_0x263e10(0xeb)]['cursor']=_0x263e10(0x11c),_0x5858a0[_0x263e10(0xeb)][_0x263e10(0xcb)]=_0x263e10(0xde),_0x24c027[_0x263e10(0xdf)](_0x5858a0);const _0x46a66d=document[_0x263e10(0xc2)](_0x263e10(0xff));_0x46a66d['style'][_0x263e10(0x11e)]='1\x201\x20auto';const _0x197dc9=document['createElement'](_0x263e10(0xbc));_0x197dc9[_0x263e10(0xeb)]['background']='#f0f0f0',_0x197dc9[_0x263e10(0xeb)][_0x263e10(0xc5)]=_0x263e10(0x115),_0x197dc9[_0x263e10(0xeb)][_0x263e10(0xd3)]='10px',_0x197dc9[_0x263e10(0xeb)][_0x263e10(0xce)]=_0x263e10(0xf4),_0x197dc9[_0x263e10(0xeb)][_0x263e10(0xc8)]='0',_0x197dc9['style'][_0x263e10(0x107)]=_0x263e10(0x10d),_0x197dc9[_0x263e10(0xeb)][_0x263e10(0x10b)]=_0x263e10(0xbe),_0x197dc9[_0x263e10(0xeb)][_0x263e10(0xb6)]='none',_0x197dc9[_0x263e10(0xeb)][_0x263e10(0xc4)]=_0x263e10(0xfb),_0x197dc9['style'][_0x263e10(0x128)]='auto',_0x46a66d[_0x263e10(0xdf)](_0x197dc9);const _0x5d589f=document[_0x263e10(0xc2)](_0x263e10(0xff));_0x5d589f[_0x263e10(0xeb)][_0x263e10(0xb6)]=_0x263e10(0x11e),_0x5d589f[_0x263e10(0xeb)][_0x263e10(0xf1)]=_0x263e10(0xc3),_0x5d589f['style'][_0x263e10(0x110)]=_0x263e10(0xb5),_0x5d589f['style'][_0x263e10(0xb4)]=_0x263e10(0xcd),_0x5d589f['style'][_0x263e10(0x11f)]=_0x263e10(0x11d);const _0x23cc1e=document[_0x263e10(0xc2)]('button');_0x23cc1e['textContent']=_0x263e10(0x10a),_0x23cc1e['style'][_0x263e10(0x12a)]=_0x263e10(0x11c),_0x23cc1e['style']['width']=_0x263e10(0xd0),_0x5d589f['appendChild'](_0x23cc1e);const _0x147c33=document[_0x263e10(0xc2)](_0x263e10(0xbd));_0x147c33[_0x263e10(0x10e)]=_0x263e10(0xfc),_0x147c33[_0x263e10(0xeb)][_0x263e10(0x12a)]='pointer',_0x147c33[_0x263e10(0xeb)][_0x263e10(0xb6)]=_0x263e10(0xb7),_0x147c33['style'][_0x263e10(0xcb)]=_0x263e10(0xd0),_0x5d589f['appendChild'](_0x147c33),_0x5858a0['addEventListener'](_0x263e10(0x111),()=>{const _0x4a7100=_0x263e10;if(_0x197dc9['style']['display']===_0x4a7100(0x126))_0x197dc9[_0x4a7100(0xeb)][_0x4a7100(0xb6)]=_0x4a7100(0xb7),_0x147c33[_0x4a7100(0xeb)][_0x4a7100(0xb6)]='none';else{const _0x514449=_0x52b3de(_0x54dd06);_0x197dc9['textContent']=_0x514449,_0x197dc9['style'][_0x4a7100(0xb6)]=_0x4a7100(0x126),_0x147c33[_0x4a7100(0xeb)][_0x4a7100(0xb6)]=_0x4a7100(0xc6);}}),_0x147c33[_0x263e10(0x129)](_0x263e10(0x111),()=>{const _0x5bd8b1=_0x263e10;_0x197dc9[_0x5bd8b1(0x10e)]['trim']()&&navigator[_0x5bd8b1(0xc0)]['writeText'](_0x197dc9[_0x5bd8b1(0x10e)])[_0x5bd8b1(0x101)](()=>{const _0x58035d=_0x5bd8b1;_0x147c33['textContent']=_0x58035d(0xf2),setTimeout(()=>{const _0x9c700a=_0x58035d;_0x147c33[_0x9c700a(0x10e)]='Copy';},0x7d0);});}),_0x23cc1e[_0x263e10(0x129)]('click',async()=>{const _0x483042=_0x263e10,_0x2bc6db=document[_0x483042(0xd4)](_0x483042(0xdc));if(_0x2bc6db)_0x2bc6db[_0x483042(0x111)]();else{alert(_0x483042(0x102));return;}const _0x257e70=await _0x38dec1();if(_0x257e70){const _0x238aff=_0x257e70[_0x483042(0xfe)]||_0x257e70[_0x483042(0xf0)][_0x483042(0xe4)];_0x238aff[_0x483042(0x114)][_0x483042(0xf7)]=_0x483042(0x12b)+_0x54dd06['useremail']+'<br><br>\x0aTeams:\x20'+_0x54dd06['account']+_0x483042(0x103)+_0x333ad3+_0x483042(0x119)+_0x54dd06[_0x483042(0x100)]+_0x483042(0xda)+_0x333ad3;}else alert(_0x483042(0xec));}),_0x89e072[_0x263e10(0xdf)](_0x24c027),_0x89e072[_0x263e10(0xdf)](_0x46a66d),_0x89e072[_0x263e10(0xdf)](_0x5d589f),_0xeba21a[_0x263e10(0x12e)](_0x263e10(0xd9),_0x89e072);}window['addEventListener'](_0x1ff462(0x116),()=>{setTimeout(_0x268b5a,0x3e8);});}()));
