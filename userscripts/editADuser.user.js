// ==UserScript==
// @name         Edit AD user .PS
// @namespace    https://sqaaq.github.io/automations
// @version      1.9.5
// @description  Кнопка появляется только при наличии "Выход нового сотрудника" в заголовке
// @author       Egor & AI
// @match        https://*/front/ticket.form.php?*
// @downloadURL  https://sqaaq.github.com/automations/userscripts/editADuser.user.js
// @updateURL    https://sqaaq.github.com/automations/userscripts/editADuser.meta.js
// @grant        none
// ==/UserScript==

function b(c,d){const e=a();return b=function(f,g){f=f-(0x132c+0x143f+0x1*-0x26b3);let h=e[f];return h;},b(c,d);}(function(r,s){const N=b,t=r();while(!![]){try{const u=-parseInt(N(0xf2))/(-0x112f+0x1*-0x807+0x1937)*(-parseInt(N(0xc2))/(-0x1*-0xd13+-0x1*0xfed+0x2dc))+-parseInt(N(0xe5))/(-0x30*-0xce+0x1763+-0x1f00*0x2)+parseInt(N(0xf1))/(-0x9d6+0x1ace+0x4*-0x43d)*(-parseInt(N(0xb9))/(0xcd*0xb+0x77*-0x3+-0x765))+-parseInt(N(0xf7))/(-0x3e9+-0x7d*0x18+0xfa7)+parseInt(N(0xc1))/(-0x120b+0x1f2*-0xd+0x19*0x1bc)+parseInt(N(0xb8))/(-0x1e1*0x13+-0x23fe+0x47b9)+parseInt(N(0xbb))/(-0x207+-0x1ae0+-0x4*-0x73c);if(u===s)break;else t['push'](t['shift']());}catch(v){t['push'](t['shift']());}}}(a,-0x6*-0xb5f+0x136cd+0x6037*0x2),(function(){'use strict';function r(x){const O=b;let y=x[O(0xca)](/\D/g,'');if(y[O(0x10a)]('8')&&y['length']===-0x1621+-0x2*0xdab+-0x3182*-0x1)y='7'+y['slice'](-0x17ad+-0x9eb+0x2199*0x1);else{if(y[O(0x10a)]('9')&&y['length']===-0x2*-0x6f1+-0x26f7+0x191f)y='7'+y;else{if(y[O(0x10a)]('+7')){y=y[O(0x115)](-0x270a+-0x1c6b+0x4377);if(y['length']===0x1*-0x11db+-0x10ce*-0x1+0x117*0x1)y='7'+y;}}}if(y[O(0xe0)]===0x113d+0x5f*-0x3b+-0x191*-0x3&&y[O(0x10a)]('7'))return O(0x106)+y[O(0x115)](0xe3c+0x49*0x37+-0x1dea,-0x1*0x713+0x1ca5+0x59*-0x3e)+'\x20'+y[O(0x115)](0x115*-0x13+0x10f5+0x39e,0x1*0xf5b+-0x2193+-0xad*-0x1b)+'\x20'+y[O(0x115)](0xbf1+0x68+0xc52*-0x1,0x29f*-0x8+-0x22d1*0x1+0x37d2*0x1)+'\x20'+y['slice'](0x806+-0x1de7+0x42*0x55,-0x2*0xc0b+0x437+0x2*0x9f5);return x;}function s(x){const P=b;let y=x[P(0xdf)]()[P(0xcb)](/\s+/);if(y['length']>=0xd65+-0x19ed+0xc8a)return y[-0xf+0x1*0x1de7+-0x1*0x1dd7]+'\x20'+y[-0x1f72+0x2045+-0x1*0xd3];return x;}function t(x){const Q=b;let y={},z=x[Q(0x103)](/учетная запись\s+(\w+)/i),A=x[Q(0x103)](/Телефон:\s*(\d+)/i),B=x[Q(0x103)](/Дата рождения:\s*([\d\.]+)/i),C=x[Q(0x103)](/Руководитель:\s*([\u0400-\u04FF\s\-]+)/i),D=x[Q(0x103)](/Почтовый домен:\s*([\w\.\-]+)/i);if(z)y['c']=z[-0x12de+0x1*-0x62b+0x281*0xa];if(A)y[Q(0x101)]=r(A[0x2*0xee6+0x11e+0xc1*-0x29]);if(B)y['d']=B[0x24e*-0x5+0xc5*0x14+-0x3dd];if(C)y['e']=C[-0x21*0xb9+-0x1945+0x311f][Q(0xdf)]();if(D){const E=D[-0x174e*-0x1+-0x3*0x619+0x281*-0x2]['toLowerCase'](),F={'f':Q(0xe8),'g':Q(0x105),'h':'ADV','i':'ADV\x20Benchmark','j':Q(0xe6),'k':Q(0x118),'l':Q(0xfc),'m':Q(0x100),'n':'UM','o':Q(0xf4),'p':'ADVelop'};y['q']=F[E]||'';}return y;}function u(x){const R=b;if(!x['c']||!x['phone']||!x['d']||!x['e'])return'Ошибка:\x20Не\x20найдены\x20необходимые\x20поля\x20в\x20заявке.';let y=s(x['e']);return(R(0xed)+y+R(0x113)+x['c']+R(0xfb)+x[R(0x101)]+R(0x111)+x['d']+R(0xd4)+x['q']+R(0xfe)+x['c']+'\x27\x20-Replace\x20@{mobile=\x27'+x[R(0x101)]+R(0x111)+x['d']+'\x27;\x20company=\x27'+x['q']+R(0xd0)+x['c']+R(0xd1)+x['c']+R(0xcf)+x['c']+'\x27\x0a')['trim']();}function v(){return new Promise(x=>{const y=()=>{const S=b,z=document[S(0xda)](S(0x104));if(z)x(z);else setTimeout(y,0x29*-0x86+-0xb48+0x2*0x1159);};y();});}function w(){const T=b,x=document['querySelector']('.mt-2.timeline-content.left.card');if(!x)return;const y=x[T(0xda)](T(0xe9));if(!y||!/выход нового сотрудника/i[T(0xc0)](y[T(0xf0)]))return;const z=x['querySelector']('.rich_text_container');if(!z||x[T(0xda)](T(0xd6)))return;const A=x[T(0xcc)],B=t(A),C=document[T(0x107)](T(0xe2));C[T(0xf6)][T(0x10b)](T(0xff)),C[T(0xe4)][T(0x117)]=T(0xcd),C['style'][T(0xba)]=T(0xdd),C[T(0xe4)][T(0xea)]=T(0xc4),C[T(0xe4)]['marginTop']='10px';const D=document['createElement']('div');D[T(0xe4)][T(0x117)]=T(0xcd),D[T(0xe4)][T(0x109)]=T(0x10d),D[T(0xe4)][T(0xc7)]=T(0xdd),D[T(0xe4)][T(0xba)]=T(0xec);const E=document[T(0x107)]('button');E[T(0xf0)]=T(0x114),E[T(0xe4)][T(0xd9)]='pointer',E[T(0xe4)][T(0xc3)]=T(0xee),D[T(0xbc)](E);const F=document[T(0x107)](T(0xe2));F[T(0xe4)][T(0xcd)]=T(0x116);const G=document[T(0x107)](T(0xf3));G['style'][T(0xdb)]=T(0xc8),G[T(0xe4)]['border']=T(0x112),G[T(0xe4)][T(0xe3)]=T(0x108),G[T(0xe4)][T(0xc5)]=T(0xf8),G['style'][T(0xde)]='0',G['style'][T(0xbe)]=T(0xdc),G['style'][T(0xf9)]='600px',G[T(0xe4)]['display']='none',G[T(0xe4)][T(0xce)]='200px',G[T(0xe4)]['overflowY']=T(0xbd),F[T(0xbc)](G);const H=document['createElement'](T(0xe2));H['style'][T(0x117)]=T(0xcd),H[T(0xe4)][T(0x109)]=T(0x10d),H[T(0xe4)][T(0xc7)]='flex-start',H[T(0xe4)][T(0xba)]=T(0xec),H[T(0xe4)][T(0xea)]=T(0x108);const I=document[T(0x107)](T(0xc9));I[T(0xf0)]=T(0xd5),I['style'][T(0xd9)]=T(0xfa),I[T(0xe4)][T(0xc3)]=T(0x10e),H[T(0xbc)](I);const J=document['createElement']('button');J[T(0xf0)]='Copy.PS',J['style'][T(0xd9)]=T(0xfa),J['style'][T(0x117)]=T(0xeb),J['style'][T(0xc3)]=T(0x10e),H[T(0xbc)](J),E['addEventListener'](T(0xef),()=>{const U=T;if(G[U(0xe4)][U(0x117)]==='block')G['style'][U(0x117)]=U(0xeb),J['style']['display']=U(0xeb);else{const K=u(B);G[U(0xf0)]=K,G[U(0xe4)]['display']=U(0x10f),J[U(0xe4)][U(0x117)]=U(0xd7);}}),J['addEventListener'](T(0xef),()=>{const V=T;G[V(0xf0)][V(0xdf)]()&&navigator[V(0x10c)]['writeText'](G[V(0xf0)])['then'](()=>{const W=V;J[W(0xf0)]=W(0x110),setTimeout(()=>{const X=W;J['textContent']=X(0xfd);},-0x805*-0x2+-0x1de0+0xad3*0x2);});}),I[T(0xbf)](T(0xef),async()=>{const Y=T,K=document['querySelector'](Y(0x102));if(K)K['click']();else{alert(Y(0xe7));return;}const L=await v();if(L){const M=L['contentDocument']||L[Y(0xe1)]['document'];M[Y(0xf5)][Y(0xc6)]=Y(0x119)+B['c']+Y(0xd3)+B['c']+'<br>\x0aПароль:\x20123qwe!@#';}else alert(Y(0xd8));}),C['appendChild'](D),C[T(0xbc)](F),C[T(0xbc)](H),z[T(0xd2)]('afterend',C);}window['addEventListener']('load',()=>{setTimeout(w,-0x1a1e+0x5*0x6c8+0x8e*-0x7);});}()));function a(){const Z=['791022hewYDk','ADV\x20Digital','Кнопка\x20\x22Ответ\x22\x20не\x20найдена','Points','.card-title.card-header.mx-n3.mt-n3','gap','none','center','\x0a$managers\x20=\x20Get-ADUser\x20-Filter\x20{\x20info\x20-like\x20\x22*','120px','click','textContent','1900opKFRI','56733cJDnVk','pre','ADV\x20eCommerce','body','classList','73470ymjRyF','pre-wrap','maxWidth','pointer','\x27\x20-Replace\x20@{mobile=\x27','Initiative','Copy','\x27}\x20-Manager\x20$managerDN\x0a}\x20else\x20{\x0a\x20\x20\x20\x20Set-ADUser\x20-Identity\x20\x27','edit-ps-container','OTC','phone','button.answer-action','match','iframe[id^=\x22content_\x22]','Arena','+7\x20','createElement','10px','flexDirection','startsWith','add','clipboard','column','100px','block','Copied!','\x27;\x20extensionAttribute1=\x27','1px\x20solid\x20#ccc','*\x22\x20}\x20-Properties\x20SamAccountName,\x20DistinguishedName\x0a$primaryManager\x20=\x20$managers\x20|\x20Where-Object\x20{\x20$_.SamAccountName\x20-notmatch\x20\x22^[A-Z]{3}\x5c.\x22\x20}\x20|\x20Select-Object\x20-First\x201\x0a\x0aif\x20($primaryManager\x20-ne\x20$null)\x20{\x0a\x20\x20\x20\x20$managerDN\x20=\x20$primaryManager.DistinguishedName\x0a\x20\x20\x20\x20Set-ADUser\x20-Identity\x20\x27','EditADuser.PS','slice','1\x201\x20auto','display','ADV\x20Performance','\x0aДобрый\x20день!<br>\x0aУчетная\x20запись\x20готова.<br>\x0aПочта:\x20<br><br>\x0aTeams:\x20','1261128wOqRIP','1565JePiBF','alignItems','586764kdtWhC','appendChild','auto','minWidth','addEventListener','test','2039219lDKxQS','2GeQuPA','width','25px','whiteSpace','innerHTML','justifyContent','#f0f0f0','button','replace','split','innerText','flex','maxHeight','\x27\x0aAdd-ADGroupMember\x20-Identity\x20\x22SG-G-AnyconnectUsers\x22\x20-Members\x20\x27','\x27}\x0a}\x0a\x0aSet-ADAccountPassword\x20-Identity\x20\x27','\x27\x20-NewPassword\x20(ConvertTo-SecureString\x20\x22123qwe!@#\x22\x20-AsPlainText\x20-Force)\x20-Reset\x0aEnable-ADAccount\x20-Identity\x20\x27','insertAdjacentElement','@advmoscow.ru<br>\x0aПароль:\x20123qwe!@#<br><br>\x0aНоутбук\x20|\x20rds.advmoscow.ru\x20|\x20Удаленный\x20рабочий\x20стол<br>\x0aЛогин:\x20advmoscow\x5c','\x27;\x20company=\x27','AutoAnswer','.edit-ps-container','inline-block','Не\x20найдено\x20поле\x20ввода','cursor','querySelector','background','300px','flex-start','margin','trim','length','contentWindow','div','padding','style'];a=function(){return Z;};return a();}
