// ==UserScript==
// @name         Edit AD user .PS
// @namespace    https://sqaaq.github.io/automations
// @version      1.11.2
// @description  Кнопка появляется только при наличии "Выход нового сотрудника" в заголовке + FullAutoAnswer + Passw gen + mailbox create
// @author       Egor & AI
// @match        https://*/front/ticket.form.php?*
// @downloadURL  https://sqaaq.github.io/automations/userscripts/editADuser.user.js
// @updateURL    https://sqaaq.github.io/automations/userscripts/editADuser.meta.js
// @grant        none
// ==/UserScript==

function _0x428f(_0x1c9714,_0x2b2bea){_0x1c9714=_0x1c9714-0xd6;const _0x187cd3=_0x187c();let _0x428f5e=_0x187cd3[_0x1c9714];return _0x428f5e;}function _0x187c(){const _0x1806ab=['Points','flex','iframe[id^=\x22content_\x22]','Copy.PS','1024568Mpznmu','column','308105AxSvgt','domain','300px','ADVelop','ABCDEFGHJKLMNPQRSTUVWXYZ','block','innerHTML','maxWidth','match','10px','Ошибка:\x20Не\x20найдены\x20необходимые\x20поля\x20в\x20заявке.','<br><br>\x0aНоутбук\x20|\x20rds.advmoscow.ru\x20|\x20Удаленный\x20рабочий\x20стол<br>\x0aЛогин:\x20advmoscow\x5c','maxHeight','fio','100px','click','284VHhKYf','load','EditADuser.PS','.card-title.card-header.mx-n3.mt-n3','afterend','appendChild','Copied!','split','marginTop','addEventListener','3dNSyVy','join','@advmoscow.ru<br>\x0aПароль:\x20','Initiative','\x27;\x20company=\x27','1314RYuTFL','inline-block','insertAdjacentElement','slice','3410286bgRiEI','test','602156WVtJce','abcdefghjkmnpqrstuvwxyz','random','600px','toLowerCase','display','\x27\x0aGet-Mailbox\x20-Identity\x20\x27','13854ChGRBp','company','innerText','#f0f0f0','\x27\x0aAdd-ADGroupMember\x20-Identity\x20\x22SG-G-AnyconnectUsers\x22\x20-Members\x20\x27','justifyContent','cursor','overflowY','replace','whiteSpace','center','200px','\x27;\x20extensionAttribute1=\x27','\x27\x20-Replace\x20@{mobile=\x27','minWidth','birth_date','manager','.mt-2.timeline-content.left.card','clipboard','\x27\x0a$Session\x20=\x20New-PSSession\x20-ConfigurationName\x20Microsoft.Exchange\x20-ConnectionUri\x20http://DC1-EXCH-02.advmoscow.ru/PowerShell/\x20-Authentication\x20Kerberos\x0aImport-PSSession\x20$Session\x0aEnable-Mailbox\x20-Identity\x20\x27','20zKOvYg','flexDirection','phone','then','Не\x20найдено\x20поле\x20ввода','button','ADV\x20Benchmark','contentWindow','border','pointer','AutoAnswer','none','ADV','.rich_text_container','gap','trim','padding','120px','\x27}\x0a}\x0a\x0aSet-ADAccountPassword\x20-Identity\x20\x27','\x0aДобрый\x20день!<br>\x0aУчетная\x20запись\x20готова.<br>\x0aПочта:\x20','\x27}\x20-Manager\x20$managerDN\x0a}\x20else\x20{\x0a\x20\x20\x20\x20Set-ADUser\x20-Identity\x20\x27','alignItems','Arena','startsWith','createElement','useremail','length','.edit-ps-container','auto','25px','contentDocument','style','flex-start','\x0a$managers\x20=\x20Get-ADUser\x20-Filter\x20{\x20info\x20-like\x20\x22*','pre-wrap','95uogCJv','button.answer-action','account','margin','99819PgGUyi','\x27\x20|\x20Select-Object\x20DisplayName,PrimarySmtpAddress\x20|\x20Format-List\x0aRemove-PSSession\x20$Session\x0aWrite-Output\x20\x22DON\x27T\x20FORGET\x20TO\x20CHANGE\x20USER\x20OU\x22\x0a','querySelector','floor','\x27\x20-NewPassword\x20(ConvertTo-SecureString\x20\x22','div','ADV\x20Digital','1px\x20solid\x20#ccc','width','OTC','<br>\x0aПароль:\x20','textContent'];_0x187c=function(){return _0x1806ab;};return _0x187c();}(function(_0x68b6bd,_0xb93783){const _0x12123a=_0x428f,_0x6e5f6=_0x68b6bd();while(!![]){try{const _0x1e8f27=-parseInt(_0x12123a(0x12b))/0x1*(-parseInt(_0x12123a(0x11c))/0x2)+-parseInt(_0x12123a(0x126))/0x3*(parseInt(_0x12123a(0x131))/0x4)+-parseInt(_0x12123a(0xf6))/0x5*(parseInt(_0x12123a(0x138))/0x6)+-parseInt(_0x12123a(0x10c))/0x7+-parseInt(_0x12123a(0x10a))/0x8+-parseInt(_0x12123a(0xfa))/0x9*(parseInt(_0x12123a(0x14c))/0xa)+parseInt(_0x12123a(0x12f))/0xb;if(_0x1e8f27===_0xb93783)break;else _0x6e5f6['push'](_0x6e5f6['shift']());}catch(_0x3a7998){_0x6e5f6['push'](_0x6e5f6['shift']());}}}(_0x187c,0x1a5a0),(function(){'use strict';const _0x302397=_0x428f;function _0x4215f5(_0x37f37a){const _0x4501b1=_0x428f;let _0x1f0e3f=_0x37f37a[_0x4501b1(0x140)](/\D/g,'');if(_0x1f0e3f[_0x4501b1(0xea)]('8')&&_0x1f0e3f[_0x4501b1(0xed)]===0xb)_0x1f0e3f='7'+_0x1f0e3f[_0x4501b1(0x12e)](0x1);else{if(_0x1f0e3f[_0x4501b1(0xea)]('9')&&_0x1f0e3f[_0x4501b1(0xed)]===0xa)_0x1f0e3f='7'+_0x1f0e3f;else{if(_0x1f0e3f[_0x4501b1(0xea)]('+7')){_0x1f0e3f=_0x1f0e3f[_0x4501b1(0x12e)](0x2);if(_0x1f0e3f[_0x4501b1(0xed)]===0xa)_0x1f0e3f='7'+_0x1f0e3f;}}}if(_0x1f0e3f[_0x4501b1(0xed)]===0xb&&_0x1f0e3f[_0x4501b1(0xea)]('7'))return'+7\x20'+_0x1f0e3f[_0x4501b1(0x12e)](0x1,0x4)+'\x20'+_0x1f0e3f[_0x4501b1(0x12e)](0x4,0x7)+'\x20'+_0x1f0e3f[_0x4501b1(0x12e)](0x7,0x9)+'\x20'+_0x1f0e3f[_0x4501b1(0x12e)](0x9,0xb);return _0x37f37a;}function _0x21d995(_0x16c59b=0xc){const _0x1e00a4=_0x428f,_0x5ce839=_0x1e00a4(0x110),_0x195feb=_0x1e00a4(0x132),_0x46e67d='23456789',_0x519c12=_0x5ce839+_0x195feb+_0x46e67d;let _0x1cd280=[_0x5ce839[Math[_0x1e00a4(0xfd)](Math[_0x1e00a4(0x133)]()*_0x5ce839[_0x1e00a4(0xed)])],_0x195feb[Math[_0x1e00a4(0xfd)](Math[_0x1e00a4(0x133)]()*_0x195feb[_0x1e00a4(0xed)])],_0x46e67d[Math[_0x1e00a4(0xfd)](Math['random']()*_0x46e67d['length'])]];for(let _0xe07dec=0x3;_0xe07dec<_0x16c59b;_0xe07dec++){_0x1cd280['push'](_0x519c12[Math[_0x1e00a4(0xfd)](Math[_0x1e00a4(0x133)]()*_0x519c12[_0x1e00a4(0xed)])]);}for(let _0x47360e=_0x1cd280['length']-0x1;_0x47360e>0x0;_0x47360e--){const _0x2b76c1=Math[_0x1e00a4(0xfd)](Math[_0x1e00a4(0x133)]()*(_0x47360e+0x1));[_0x1cd280[_0x47360e],_0x1cd280[_0x2b76c1]]=[_0x1cd280[_0x2b76c1],_0x1cd280[_0x47360e]];}return _0x1cd280[_0x1e00a4(0x127)]('');}const _0x1ae5ed=_0x21d995();function _0x50e36b(_0x985c1){const _0x26a29a=_0x428f;let _0x312987=_0x985c1[_0x26a29a(0xe2)]()[_0x26a29a(0x123)](/\s+/);if(_0x312987[_0x26a29a(0xed)]>=0x2)return _0x312987[0x1]+'\x20'+_0x312987[0x0];return _0x985c1;}function _0xed3316(_0x2f6f5f){const _0x5b86bb=_0x428f;if(!_0x2f6f5f||!_0x2f6f5f[_0x5b86bb(0xed)])return'';return _0x2f6f5f[0x0]['toUpperCase']()+_0x2f6f5f[_0x5b86bb(0x12e)](0x1)[_0x5b86bb(0x135)]();}function _0x1ba500(_0x171dcf,_0x239ca2){const _0x8d269b=_0x428f;let _0x18245c=_0x171dcf[_0x8d269b(0xe2)]()[_0x8d269b(0x123)](/\s+/);if(_0x18245c['length']<0x2)return'';let _0x14b21e=_0xed3316(_0x18245c[0x1]),_0x14557d=_0xed3316(_0x18245c[0x0]);return _0x14b21e+'.'+_0x14557d+'@'+_0x239ca2;}function _0xa92d63(_0xbd632f){const _0x414859=_0x428f;let _0x5c6fc9={},_0x393a11=_0xbd632f[_0x414859(0x114)](/учетная запись\s+(\w+)/i),_0x485368=_0xbd632f['match'](/Телефон:\s*(\d+)/i),_0x4c0acd=_0xbd632f[_0x414859(0x114)](/Дата рождения:\s*([\d\.]+)/i),_0xca83f5=_0xbd632f[_0x414859(0x114)](/Руководитель:\s*([\u0400-\u04FF\s\-]+)/i),_0x50f043=_0xbd632f[_0x414859(0x114)](/Почтовый домен:\s*([\w\.\-]+)/i),_0x411a45=_0xbd632f[_0x414859(0x114)](/Фамилия\/имя:\s*([A-Za-zА-Яа-яЁё\s\-]+)/i);if(_0x393a11)_0x5c6fc9[_0x414859(0xf8)]=_0x393a11[0x1];if(_0x485368)_0x5c6fc9['phone']=_0x4215f5(_0x485368[0x1]);if(_0x4c0acd)_0x5c6fc9['birth_date']=_0x4c0acd[0x1];if(_0xca83f5)_0x5c6fc9[_0x414859(0x148)]=_0xca83f5[0x1][_0x414859(0xe2)]();if(_0x50f043){let _0x4dc3b1=_0x50f043[0x1][_0x414859(0x135)]();_0x4dc3b1[_0x414859(0xea)]('@')&&(_0x4dc3b1=_0x4dc3b1[_0x414859(0x12e)](0x1));const _0x3527c4={'pointsgroup.ru':_0x414859(0x106),'arenamb.ru':_0x414859(0xe9),'advgroup.ru':_0x414859(0xdf),'advbenchmark.ru':_0x414859(0xd9),'advdigital.ru':_0x414859(0x100),'advperformance.ru':'ADV\x20Performance','initiativemedia.ru':_0x414859(0x129),'otc24.ru':_0x414859(0x103),'umww.ru':'UM','advecomm.ru':'ADV\x20eCommerce','advelop.ru':_0x414859(0x10f)};_0x5c6fc9[_0x414859(0x139)]=_0x3527c4[_0x4dc3b1]||'',_0x5c6fc9[_0x414859(0x10d)]=_0x4dc3b1;}return _0x411a45&&_0x50f043&&(_0x5c6fc9['fio']=_0x411a45[0x1]['trim'](),_0x5c6fc9[_0x414859(0xec)]=_0x1ba500(_0x5c6fc9[_0x414859(0x119)],_0x5c6fc9['domain'])),_0x5c6fc9;}function _0x78c551(_0x44ab35){const _0x1022cf=_0x428f;if(!_0x44ab35[_0x1022cf(0xf8)]||!_0x44ab35[_0x1022cf(0x14e)]||!_0x44ab35[_0x1022cf(0x147)]||!_0x44ab35[_0x1022cf(0x148)])return _0x1022cf(0x116);let _0xf44482=_0x50e36b(_0x44ab35[_0x1022cf(0x148)]);return(_0x1022cf(0xf4)+_0xf44482+'*\x22\x20}\x20-Properties\x20SamAccountName,\x20DistinguishedName\x0a$primaryManager\x20=\x20$managers\x20|\x20Where-Object\x20{\x20$_.SamAccountName\x20-notmatch\x20\x22^[A-Z]{3}\x5c.\x22\x20}\x20|\x20Select-Object\x20-First\x201\x0a\x0aif\x20($primaryManager\x20-ne\x20$null)\x20{\x0a\x20\x20\x20\x20$managerDN\x20=\x20$primaryManager.DistinguishedName\x0a\x20\x20\x20\x20Set-ADUser\x20-Identity\x20\x27'+_0x44ab35[_0x1022cf(0xf8)]+_0x1022cf(0x145)+_0x44ab35['phone']+_0x1022cf(0x144)+_0x44ab35['birth_date']+'\x27;\x20company=\x27'+_0x44ab35[_0x1022cf(0x139)]+_0x1022cf(0xe7)+_0x44ab35[_0x1022cf(0xf8)]+'\x27\x20-Replace\x20@{mobile=\x27'+_0x44ab35[_0x1022cf(0x14e)]+_0x1022cf(0x144)+_0x44ab35[_0x1022cf(0x147)]+_0x1022cf(0x12a)+_0x44ab35[_0x1022cf(0x139)]+_0x1022cf(0xe5)+_0x44ab35[_0x1022cf(0xf8)]+_0x1022cf(0xfe)+_0x1ae5ed+'\x22\x20-AsPlainText\x20-Force)\x20-Reset\x0aEnable-ADAccount\x20-Identity\x20\x27'+_0x44ab35['account']+_0x1022cf(0x13c)+_0x44ab35['account']+_0x1022cf(0x14b)+_0x44ab35[_0x1022cf(0xf8)]+_0x1022cf(0x137)+_0x44ab35[_0x1022cf(0xf8)]+_0x1022cf(0xfb))['trim']();}function _0x3aba33(){return new Promise(_0x918888=>{const _0x551a80=()=>{const _0x5041ce=_0x428f,_0x4e6548=document[_0x5041ce(0xfc)](_0x5041ce(0x108));if(_0x4e6548)_0x918888(_0x4e6548);else setTimeout(_0x551a80,0x1f4);};_0x551a80();});}function _0xb199e5(){const _0x4fec06=_0x428f,_0x4cafa4=document[_0x4fec06(0xfc)](_0x4fec06(0x149));if(!_0x4cafa4)return;const _0x31d672=_0x4cafa4['querySelector'](_0x4fec06(0x11f));if(!_0x31d672||!/выход нового сотрудника/i[_0x4fec06(0x130)](_0x31d672[_0x4fec06(0x105)]))return;const _0x49a46e=_0x4cafa4[_0x4fec06(0xfc)](_0x4fec06(0xe0));if(!_0x49a46e||_0x4cafa4[_0x4fec06(0xfc)](_0x4fec06(0xee)))return;const _0x414af1=_0x4cafa4[_0x4fec06(0x13a)],_0x2915b1=_0xa92d63(_0x414af1),_0x1702fe=document[_0x4fec06(0xeb)](_0x4fec06(0xff));_0x1702fe['classList']['add']('edit-ps-container'),_0x1702fe[_0x4fec06(0xf2)][_0x4fec06(0x136)]='flex',_0x1702fe[_0x4fec06(0xf2)]['alignItems']=_0x4fec06(0xf3),_0x1702fe[_0x4fec06(0xf2)]['gap']=_0x4fec06(0xf0),_0x1702fe[_0x4fec06(0xf2)][_0x4fec06(0x124)]=_0x4fec06(0x115);const _0x563a75=document['createElement']('div');_0x563a75['style']['display']=_0x4fec06(0x107),_0x563a75[_0x4fec06(0xf2)][_0x4fec06(0x14d)]=_0x4fec06(0x10b),_0x563a75['style']['justifyContent']=_0x4fec06(0xf3),_0x563a75[_0x4fec06(0xf2)][_0x4fec06(0xe8)]=_0x4fec06(0x142);const _0x2ccf88=document[_0x4fec06(0xeb)]('button');_0x2ccf88[_0x4fec06(0x105)]=_0x4fec06(0x11e),_0x2ccf88[_0x4fec06(0xf2)][_0x4fec06(0x13e)]=_0x4fec06(0xdc),_0x2ccf88[_0x4fec06(0xf2)]['width']=_0x4fec06(0xe4),_0x563a75['appendChild'](_0x2ccf88);const _0xbd6d22=document[_0x4fec06(0xeb)](_0x4fec06(0xff));_0xbd6d22[_0x4fec06(0xf2)]['flex']='1\x201\x20auto';const _0x4a2bd8=document['createElement']('pre');_0x4a2bd8['style']['background']=_0x4fec06(0x13b),_0x4a2bd8[_0x4fec06(0xf2)][_0x4fec06(0xdb)]=_0x4fec06(0x101),_0x4a2bd8[_0x4fec06(0xf2)][_0x4fec06(0xe3)]='10px',_0x4a2bd8['style'][_0x4fec06(0x141)]=_0x4fec06(0xf5),_0x4a2bd8[_0x4fec06(0xf2)][_0x4fec06(0xf9)]='0',_0x4a2bd8['style'][_0x4fec06(0x146)]=_0x4fec06(0x10e),_0x4a2bd8[_0x4fec06(0xf2)][_0x4fec06(0x113)]=_0x4fec06(0x134),_0x4a2bd8[_0x4fec06(0xf2)][_0x4fec06(0x136)]=_0x4fec06(0xde),_0x4a2bd8[_0x4fec06(0xf2)][_0x4fec06(0x118)]=_0x4fec06(0x143),_0x4a2bd8['style'][_0x4fec06(0x13f)]=_0x4fec06(0xef),_0xbd6d22[_0x4fec06(0x121)](_0x4a2bd8);const _0x390d78=document['createElement']('div');_0x390d78[_0x4fec06(0xf2)][_0x4fec06(0x136)]=_0x4fec06(0x107),_0x390d78[_0x4fec06(0xf2)][_0x4fec06(0x14d)]=_0x4fec06(0x10b),_0x390d78[_0x4fec06(0xf2)][_0x4fec06(0x13d)]=_0x4fec06(0xf3),_0x390d78[_0x4fec06(0xf2)][_0x4fec06(0xe8)]='center',_0x390d78[_0x4fec06(0xf2)][_0x4fec06(0xe1)]=_0x4fec06(0x115);const _0x3d6972=document[_0x4fec06(0xeb)]('button');_0x3d6972['textContent']=_0x4fec06(0xdd),_0x3d6972[_0x4fec06(0xf2)][_0x4fec06(0x13e)]=_0x4fec06(0xdc),_0x3d6972[_0x4fec06(0xf2)]['width']='100px',_0x390d78[_0x4fec06(0x121)](_0x3d6972);const _0x41c0d9=document[_0x4fec06(0xeb)](_0x4fec06(0xd8));_0x41c0d9[_0x4fec06(0x105)]=_0x4fec06(0x109),_0x41c0d9['style']['cursor']=_0x4fec06(0xdc),_0x41c0d9[_0x4fec06(0xf2)]['display']='none',_0x41c0d9[_0x4fec06(0xf2)][_0x4fec06(0x102)]=_0x4fec06(0x11a),_0x390d78[_0x4fec06(0x121)](_0x41c0d9),_0x2ccf88[_0x4fec06(0x125)]('click',()=>{const _0x376371=_0x4fec06;if(_0x4a2bd8['style'][_0x376371(0x136)]===_0x376371(0x111))_0x4a2bd8[_0x376371(0xf2)][_0x376371(0x136)]='none',_0x41c0d9[_0x376371(0xf2)][_0x376371(0x136)]=_0x376371(0xde);else{const _0x35a3b9=_0x78c551(_0x2915b1);_0x4a2bd8[_0x376371(0x105)]=_0x35a3b9,_0x4a2bd8[_0x376371(0xf2)][_0x376371(0x136)]=_0x376371(0x111),_0x41c0d9[_0x376371(0xf2)][_0x376371(0x136)]=_0x376371(0x12c);}}),_0x41c0d9[_0x4fec06(0x125)](_0x4fec06(0x11b),()=>{const _0x503fd1=_0x4fec06;_0x4a2bd8['textContent'][_0x503fd1(0xe2)]()&&navigator[_0x503fd1(0x14a)]['writeText'](_0x4a2bd8[_0x503fd1(0x105)])[_0x503fd1(0xd6)](()=>{const _0x37f6b3=_0x503fd1;_0x41c0d9[_0x37f6b3(0x105)]=_0x37f6b3(0x122),setTimeout(()=>{const _0x3730fb=_0x37f6b3;_0x41c0d9[_0x3730fb(0x105)]='Copy';},0x7d0);});}),_0x3d6972[_0x4fec06(0x125)](_0x4fec06(0x11b),async()=>{const _0x588912=_0x4fec06,_0x8ef582=document[_0x588912(0xfc)](_0x588912(0xf7));if(_0x8ef582)_0x8ef582[_0x588912(0x11b)]();else{alert('Кнопка\x20\x22Ответ\x22\x20не\x20найдена');return;}const _0x42c726=await _0x3aba33();if(_0x42c726){const _0x42b88c=_0x42c726[_0x588912(0xf1)]||_0x42c726[_0x588912(0xda)]['document'];_0x42b88c['body'][_0x588912(0x112)]=_0x588912(0xe6)+_0x2915b1[_0x588912(0xec)]+'<br><br>\x0aВход\x20в\x20Teams/Яндекс:\x20'+_0x2915b1[_0x588912(0xf8)]+_0x588912(0x128)+_0x1ae5ed+_0x588912(0x117)+_0x2915b1['account']+_0x588912(0x104)+_0x1ae5ed;}else alert(_0x588912(0xd7));}),_0x1702fe[_0x4fec06(0x121)](_0x563a75),_0x1702fe['appendChild'](_0xbd6d22),_0x1702fe[_0x4fec06(0x121)](_0x390d78),_0x49a46e[_0x4fec06(0x12d)](_0x4fec06(0x120),_0x1702fe);}window['addEventListener'](_0x302397(0x11d),()=>{setTimeout(_0xb199e5,0x3e8);});}()));
